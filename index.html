<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sony AI Color Lab Web-App</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 6.253v11.494m-5.747-8.662l11.494 5.747m-11.494 0l11.494-5.747M4.75 12A7.25 7.25 0 0112 4.75v0A7.25 7.25 0 0119.25 12v0a7.25 7.25 0 01-7.25 7.25v0A7.25 7.25 0 014.75 12v0z' stroke='%231d1d1f' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' fill='none'%3E%3C/path%3E%3C/svg%3E">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<!-- OPTIMIZATION: Defer non-critical scripts to speed up initial page load -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
<style>
html { scroll-behavior: smooth; }
body {
font-family: 'Be Vietnam Pro', sans-serif;
background-color: #f4f7fc;
color: #212529;
overflow-x: hidden;
overflow-y: auto;
}

#bg-blurs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
.blur-circle { position: absolute; border-radius: 50%; filter: blur(180px); opacity: 0.15; transition: all 2s ease-in-out; }
.blur-1 { width: 40vw; height: 40vw; max-width: 500px; max-height: 500px; background: #007AFF; top: 5%; left: 10%; animation: move-blur-1 30s infinite alternate; }
.blur-2 { width: 50vw; height: 50vw; max-width: 600px; max-height: 600px; background: #FF9500; bottom: 5%; right: 10%; animation: move-blur-2 35s infinite alternate; }
@keyframes move-blur-1 { from { transform: translate(0, 0) scale(1) rotate(0deg); } to { transform: translate(10vw, 5vh) scale(1.3) rotate(55deg); } }
@keyframes move-blur-2 { from { transform: translate(0, 0) scale(1) rotate(0deg); } to { transform: translate(-8vw, -5vh) scale(1.2) rotate(-70deg); } }

:root {
--primary-accent: #007AFF;
--primary-accent-darker: #0056B3;
--glass-bg: rgba(255, 255, 255, 0.55);
--glass-border: rgba(0, 0, 0, 0.07);
--text-primary: #1d1d1f;
--text-secondary: #6e6e73;
}

.glass-panel {Â  Â Â 
background: var(--glass-bg);Â  Â Â 
backdrop-filter: blur(40px) saturate(180%);Â  Â Â 
-webkit-backdrop-filter: blur(40px) saturate(180%);Â  Â Â 
border: 1px solid var(--glass-border);Â  Â Â 
box-shadow: 0 10px 35px rgba(0, 0, 0, 0.08);
border-radius: 24px;
}
@media (min-width: 768px) {
.glass-panel { border-radius: 28px; }
}

.recipe-item.selected {Â  Â Â 
background-color: rgba(0, 122, 255, 0.1);Â  Â Â 
border-left: 4px solid var(--primary-accent);Â  Â Â 
color: var(--text-primary);Â  Â Â 
transform: translateX(4px);
box-shadow: 0 4px 12px rgba(0, 122, 255, 0.1);
}
.recipe-item:hover:not(.selected) { background-color: rgba(0, 0, 0, 0.04); }
.recipe-dot { transition: transform 0.2s ease-in-out; }
.recipe-dot:hover { transform: scale(1.25); }

.btn { border-radius: 9999px; font-weight: 600; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;}
.btn-primary { background-color: var(--primary-accent); border: none; color: white; box-shadow: 0 4px 14px rgba(0, 118, 255, 0.39); }
.btn-primary:hover:not(:disabled) { background-color: var(--primary-accent-darker); transform: translateY(-2px) scale(1.02); box-shadow: 0 6px 18px rgba(0, 118, 255, 0.45); }
.btn:disabled { background-color: #b0bec5; cursor: not-allowed; opacity: 0.7; box-shadow: none; }

.lang-btn { background: #e9ecef; border: none; border-radius: 9999px; padding: 0.25rem; transition: all 0.2s ease; }
.lang-btn.active { box-shadow: 0 0 0 2.5px var(--primary-accent); }
.lang-btn svg { width: 1.5rem; height: 1.5rem; }

.landing-title { font-size: clamp(2.2rem, 5.5vw, 4.5rem); font-weight: 800; color: var(--text-primary); line-height: 1.1; letter-spacing: -0.025em; }
.quiz-question-title { font-size: clamp(1.7rem, 5vw, 3rem); font-weight: 700; color: var(--text-primary); line-height: 1.15; letter-spacing: -0.02em; }
.landing-subtitle { font-size: clamp(1rem, 2.5vw, 1.25rem); color: var(--text-secondary); margin-top: 1.25rem; max-width: 650px; line-height: 1.6; }

.view-transition { animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
.view-transition-out { animation: fadeOutDown 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeOutDown { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }

/* QUIZ STYLES */
.quiz-option-card {
background-color: white;
border: 2px solid #e5e7eb;
padding: 1rem;
border-radius: 1.25rem;
cursor: pointer;
transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
text-align: center;
display: flex;
flex-direction: column;
align-items: center;
gap: 0.75rem;
}
.quiz-option-card:hover {
transform: translateY(-4px);
box-shadow: 0 10px 20px rgba(0,0,0,0.07);
}
.quiz-option-card.selected {
border-color: var(--primary-accent);
background-color: rgba(0, 122, 255, 0.1);
color: var(--primary-accent);
box-shadow: 0 4px 12px rgba(0, 122, 255, 0.1);
}
.quiz-option-card svg {
width: 2.5rem;
height: 2.5rem;
color: #6b7280;
transition: color 0.2s ease;
}
.quiz-option-card.selected svg {
color: var(--primary-accent);
}
.quiz-option-card span {
font-weight: 600;
font-size: 1rem;
}
.bouncing {
animation: bounce-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes bounce-in {
0% { transform: scale(0.95); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

.filter-btn { background-color: rgba(0,0,0,0.05); border: 1px solid transparent; transition: all 0.2s ease-in-out; }
.filter-btn.active { background-color: rgba(0, 122, 255, 0.1); border-color: var(--primary-accent); color: var(--primary-accent); font-weight: 600; }

.spinner { border: 3px solid rgba(0, 0, 0, 0.1); width: 20px; height: 20px; border-radius: 50%; border-left-color: currentColor; animation: spin 1s ease infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.modal { z-index: 50; transition: opacity 0.3s ease; }
.modal-content { transition: transform 0.3s ease; border-radius: 28px; }
.modal.hidden { opacity: 0; pointer-events: none; }
.modal.hidden .modal-content { transform: scale(0.95); }

#comparisonModalContent { background-color: #f0f9ff; border-radius: 0 0 28px 28px; }
.prose-comparison h3 { font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-primary); border-bottom: 2px solid var(--primary-accent); padding-bottom: 0.5rem; }

.quiz-choice-option { cursor: pointer; transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; background: rgba(255,255,255,0.7); border-radius: 20px;}
.quiz-choice-option:hover { transform: scale(1.03); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }

.overflow-y-auto::-webkit-scrollbar { width: 10px; }
.overflow-y-auto::-webkit-scrollbar-track { background-color: transparent; }
.overflow-y-auto::-webkit-scrollbar-thumb { background-color: rgba(0, 0, 0, 0.2); border-radius: 10px; border: 3px solid transparent; background-clip: content-box; }
.overflow-y-auto::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 0, 0, 0.4); }
.overflow-y-auto { scrollbar-width: auto; scrollbar-color: rgba(0, 0, 0, 0.2) transparent; }

.chart-container { position: relative; margin: auto; height: 280px; width: 100%;}
@media (min-width: 768px) { .chart-container { height: 320px; } }
#colorChart, #bwChart { cursor: pointer; }

#mobileNavMenu { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

#lightbox { z-index: 100; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
#lightbox.hidden { opacity: 0; pointer-events: none; }
#lightbox .lightbox-content { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
#lightbox.hidden .lightbox-content { transform: scale(0.95); opacity: 0; }
.lightbox-thumb { cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease; }
.lightbox-thumb.active { border-color: var(--primary-accent); transform: scale(1.05); box-shadow: 0 0 15px rgba(0, 122, 255, 0.5); }
.lightbox-nav-btn { background-color: rgba(0,0,0,0.4); transition: background-color 0.2s ease; }
.lightbox-nav-btn:hover { background-color: rgba(0,0,0,0.7); }
#lightbox-main-image { transition: opacity 0.2s ease-in-out; }

#abgm-grid-interactive-container {
width: 100%;
max-width: 300px;
margin: auto;
touch-action: none;Â 
}
#abgm-grid {
position: relative;
width: 100%;
aspect-ratio: 1 / 1;
border-radius: 0.5rem;
cursor: pointer;
background-image:Â 
linear-gradient(to right, rgba(0, 128, 0, 0.2), rgba(255, 255, 255, 0), rgba(255, 0, 255, 0.2)),
linear-gradient(to bottom, rgba(255, 165, 0, 0.2), rgba(255, 255, 255, 0), rgba(0, 0, 255, 0.2));
box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);
}
#abgm-pointer {
position: absolute;
width: 1rem;
height: 1rem;
background-color: #ef4444;
border: 2px solid white;
border-radius: 9999px;
box-shadow: 0 0 10px rgba(0,0,0,0.5);
transform: translate(-50%, -50%);
pointer-events: none;
}
.pp-infographic-item {
background-color: #ffffff;
border: 1px solid #e5e7eb;
border-radius: 1rem;
padding: 1.5rem;
box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
}
.pp-infographic-item h5 {
color: var(--text-primary);
font-weight: 700;
font-size: 1.125rem;
}
.pp-infographic-item .param-list li {
position: relative;
padding-left: 1.5rem;
}
.pp-infographic-item .param-list li::before {
content: "âœ“";
position: absolute;
left: 0;
color: #16a34a;
font-weight: bold;
}
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QKGB56ZKQD"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-QKGB56ZKQD');
</script>
</head>
<body>
<div id="bg-blurs"><div class="blur-circle blur-1"></div><div class="blur-circle blur-2"></div></div>

<div id="appContainer" class="min-h-screen w-screen p-4 md:p-6 flex flex-col">
<header class="flex justify-between items-center w-full z-20 flex-shrink-0">
<button id="homeBtn" class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 6.253v11.494m-5.747-8.662l11.494 5.747m-11.494 0l11.494-5.747M4.75 12A7.25 7.25 0 0112 4.75v0A7.25 7.25 0 0119.25 12v0a7.25 7.25 0 01-7.25 7.25v0A7.25 7.25 0 014.75 12v0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
<span data-translate-key="headerTitle" class="hidden sm:inline"></span>
<span class="ml-2 text-[10px] font-bold text-white bg-gradient-to-r from-purple-500 via-blue-500 to-teal-400 px-2.5 py-1 rounded-full uppercase tracking-wider self-center shadow-md">Beta</span>
</button>
<div class="flex items-center gap-2 md:gap-4">
<nav id="mainNav" class="hidden md:flex items-center gap-2">
<div class="relative" id="pp-dropdown-container">
<button id="pp-dropdown-btn" class="font-semibold text-gray-600 hover:text-black transition-colors px-4 py-2 flex items-center gap-1 rounded-full hover:bg-gray-100">
<span data-translate-key="navPictureProfile"></span>
<svg class="w-4 h-4 transition-transform" id="pp-dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
</button>
<div id="pp-dropdown-menu" class="absolute top-full mt-2 w-56 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50 hidden origin-top-right transition-all duration-200 ease-out transform opacity-0 scale-95">
<button data-view="recipeFormulas" class="nav-btn text-left w-full px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-black" data-translate-key="navRecipeFormulas"></button>
<button data-view="featuredPhotos" class="nav-btn text-left w-full px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-black" data-translate-key="navFeaturedPhotos"></button>
<button data-view="explain" class="nav-btn text-left w-full px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-black" data-translate-key="navExplain"></button>
</div>
</div>
</nav>
<div class="flex items-center gap-2">
<button id="langEN" class="lang-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path d="M0,0 v30 h60 v-30 z" fill="#00247d"/><path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/><path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)" stroke="#cf142b" stroke-width="4"/><path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/><path d="M30,0 v30 M0,15 h60" stroke="#cf142b" stroke-width="6"/></svg></button>
<button id="langVI" class="lang-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600"><path fill="#da251d" d="M0 0h900v600H0z"/><path fill="#ff0" d="m450 186-86 266 226-164h-280l226 164z"/></svg></button>
</div>
<button id="hamburgerBtn" class="md:hidden p-2 rounded-full hover:bg-black/10 focus:outline-none focus:ring-2 focus:ring-gray-500">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
</button>
</div>
</header>

<div id="mainContent" class="flex-grow min-h-0 relative mt-4 md:mt-6 mb-2"></div>
</div>

<!-- Welcome Modal -->
<div id="welcomeModal" class="modal hidden fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
<div class="modal-content glass-panel w-full max-w-3xl max-h-[90vh] flex flex-col p-6 md:p-10 overflow-y-auto">
<h2 class="font-semibold text-2xl mb-6" data-translate-key="manifestoTitle"></h2>
<div class="prose prose-lg max-w-none text-gray-700 leading-relaxed space-y-4">
<p data-translate-key="manifestoBody1"></p>
<p data-translate-key="manifestoBody2"></p>
<p class="font-semibold text-xl text-center text-blue-600 py-4" data-translate-key="manifestoBody3"></p>
<p data-translate-key="manifestoBody4"></p>
<p data-translate-key="manifestoBody5"></p>
<p data-translate-key="manifestoBody6"></p>
<p class="mb-8 font-bold" data-translate-key="manifestoBody7"></p>
<p class="text-right" data-translate-key="manifestoSignature"></p>
</div>
<div class="text-center mt-8">
<button id="closeWelcomeModalBtn" class="btn btn-primary py-3 px-8 text-lg" data-translate-key="startExploringBtn"></button>
</div>
</div>
</div>

<div id="mobileNavMenu" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40 transform translate-x-full md:hidden">
<div class="absolute top-0 right-0 h-full w-2/3 max-w-sm bg-white/80 backdrop-blur-xl shadow-2xl p-6">
<button id="closeMobileNavBtn" class="absolute top-4 right-4 text-3xl p-2">&times;</button>
<nav class="mt-16 flex flex-col gap-6 text-center">
<button data-view="recipeFormulas" class="nav-btn-mobile text-2xl font-semibold text-gray-700 py-2" data-translate-key="navRecipeFormulas"></button>
<button data-view="featuredPhotos" class="nav-btn-mobile text-2xl font-semibold text-gray-700 py-2" data-translate-key="navFeaturedPhotos"></button>
<button data-view="explain" class="nav-btn-mobile text-2xl font-semibold text-gray-700 py-2" data-translate-key="navExplain"></button>
</nav>
</div>
</div>

<div id="comparisonModal" class="modal hidden fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50">
<div class="modal-content glass-panel w-full max-w-4xl max-h-[90vh] flex flex-col">
<div class="p-4 md:p-6 border-b border-black/10 flex justify-between items-center flex-shrink-0">
<h2 id="comparisonModalTitle" class="text-xl md:text-2xl font-bold"></h2>
<button id="closeComparisonModalBtn" class="text-3xl leading-none p-2 rounded-full hover:bg-black/10">&times;</button>
</div>
<div id="comparisonModalContent" class="p-6 md:p-8 overflow-y-auto prose-comparison"></div>
</div>
</div>

<div id="lightbox" class="hidden fixed inset-0 flex items-center justify-center p-4 transition-opacity duration-300">
<div id="lightbox-bg" class="absolute inset-0"></div>
<div class="lightbox-content relative w-full max-w-4xl max-h-full">
<button id="lightbox-close" class="absolute -top-4 -right-2 md:top-0 md:-right-12 text-white text-5xl font-bold z-10 leading-none p-2">&times;</button>
<div class="relative">
<img id="lightbox-main-image" src="" alt="áº¢nh demo cÃ´ng thá»©c" class="w-full h-auto max-h-[75vh] object-contain rounded-lg shadow-2xl bg-black/50">
<button id="lightbox-prev" class="lightbox-nav-btn absolute top-1/2 left-2 md:-left-16 -translate-y-1/2 p-2 md:p-3 rounded-full text-white">
<svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
</button>
<button id="lightbox-next" class="lightbox-nav-btn absolute top-1/2 right-2 md:-right-16 -translate-y-1/2 p-2 md:p-3 rounded-full text-white">
<svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
</button>
</div>
<div id="lightbox-thumbnails" class="flex justify-center items-center gap-2 md:gap-4 mt-4"></div>
</div>
</div>

<script type="module">
// --- STATE & CONFIGURATION ---
const state = {
currentLang: 'vi',
currentView: 'home',
selectedRecipeId: null,
comparisonList: [],
lastGeneratedAiRecipe: null,
isAILoading: false,
quizStep: 0,
quizAnswers: {},
activeFilters: { type: 'all', contrast: 'all', saturation: 'all' },
isMobileDetailActive: false,
lightbox: { isOpen: false, images: [], currentIndex: 0 },
};

const mainContentEl = document.getElementById('mainContent');
let activeCharts = {};

// --- DATA ---
import recipesData from './recipes.js';

const translations = {
// General
headerTitle: {vi: "Alpha AI Color Lab", en: "Alpha AI Color Lab"},
navPictureProfile: {vi: "Picture Profile", en: "Picture Profile"},
navRecipeFormulas: {vi:"CÃ´ng thá»©c mÃ u", en:"Color Recipes"},
navFeaturedPhotos: {vi: "áº¢nh ná»•i báº­t", en: "Featured Photos"},
navExplain: {vi:"Giáº£i thÃ­ch (PP)", en:"Guide (PP)"},
noteTitle: {vi:"LÆ°u Ã½ quan trá»ng", en:"Important Note"},
footerText: {vi: "PhÃ¡t triá»ƒn bá»Ÿi Sony Alpha Vietnam.", en: "Developed by Sony Alpha Vietnam."},
startExploringBtn: {vi: "Báº¯t Ä‘áº§u khÃ¡m phÃ¡", en: "Start Exploring"},
exportRecipeBtn: {vi: "LÆ°u & Xuáº¥t CÃ´ng Thá»©c", en: "Save & Export Recipe"},
downloadLutBtn: {vi: "Táº£i file .CUBE (LUT)", en: "Download .CUBE (LUT) File"},
memoryRecallBtn: {vi: "HÆ°á»›ng dáº«n lÆ°u vÃ o mÃ¡y", en: "Camera Save Guide"},

// Home / Quiz
landingTitle: {vi:"TÃ¬m mÃ u sáº¯c cá»§a riÃªng báº¡n.", en:"Find Your Signature Color."},
landingSubtitle: {vi:"Tráº£ lá»i vÃ i cÃ¢u há»i Ä‘á»ƒ khÃ¡m phÃ¡ cÃ´ng thá»©c mÃ u Ä‘Æ°á»£c AI táº¡o ra dÃ nh riÃªng cho tÃ¢m tráº¡ng vÃ  phong cÃ¡ch cá»§a báº¡n.", en:"Answer a few questions to discover a unique color recipe, tailored by AI to your mood and style."},
startQuizBtn: {vi:"KhÃ¡m phÃ¡ mÃ u cá»§a báº¡n", en:"Discover Your Color"},
quizResultTitle: {vi: "AI Ä‘á» xuáº¥t 2 lá»±a chá»n cho báº¡n:", en: "AI suggests 2 options for you:"},
viewInLibraryBtn: {vi: "Xem trong thÆ° viá»‡n", en: "View in Library"},
loadingAnalyze: {vi: "Äang phÃ¢n tÃ­ch lá»±a chá»n...", en: "Analyzing your choices..."},

// Recipe Formulas
sidebarTitle: {vi: "CÃ´ng thá»©c Picture Profile", en: "Picture Profile Recipes"},
searchInputPlaceholder: {vi: "ğŸ” TÃ¬m cÃ´ng thá»©c...", en: "ğŸ” Search recipes..."},
filterType: {vi: "Loáº¡i", en: "Type"},
filterTypeColor: {vi: "MÃ u", en: "Color"},
filterTypeBW: {vi: "Tráº¯ng Äen", en: "B&W"},
filterContrast: {vi: "TÆ°Æ¡ng pháº£n", en: "Contrast"},
filterSaturation: {vi: "BÃ£o hÃ²a", en: "Saturation"},
filterHigh: {vi: "Cao", en: "High"},
filterMedium: {vi: "Vá»«a", en: "Med"},
filterLow: {vi: "Tháº¥p", en: "Low"},
filterSort: {vi: "Sáº¯p xáº¿p theo", en: "Sort by"},
sortDefault: {vi: "Máº·c Ä‘á»‹nh", en: "Default"},
sortNameAZ: {vi: "TÃªn A-Z", en: "Name A-Z"},
sortContrastHL: {vi: "TÆ°Æ¡ng pháº£n: Cao-Tháº¥p", en: "Contrast: High-Low"},
sortSaturationHL: {vi: "BÃ£o hÃ²a: Cao-Tháº¥p", en: "Saturation: High-Low"},
compareBtn: {vi: "So sÃ¡nh báº±ng AI", en: "Compare with AI"},
recipeDetailWelcomeTitle: {vi: "ThÆ° viá»‡n mÃ u TÆ°Æ¡ng tÃ¡c", en: "Interactive Color Library"},
recipeDetailWelcomeText: {vi: "KhÃ¡m phÃ¡ cÃ¡c cÃ´ng thá»©c mÃ u Picture Profile má»™t cÃ¡ch trá»±c quan. Nháº¥p vÃ o má»™t Ä‘iá»ƒm trÃªn biá»ƒu Ä‘á»“ hoáº·c má»™t cÃ´ng thá»©c trong danh sÃ¡ch Ä‘á»ƒ xem chi tiáº¿t.", en: "Explore Picture Profile color recipes visually. Click a point on the chart or a recipe in the list to see details."},
whiteBalanceTitle: {vi: "CÃ¢n báº±ng tráº¯ng (WB)", en: "White Balance (WB)"},
recipeSettingsTitle: {vi: "CÃ i Ä‘áº·t ChÃ­nh", en: "Main Settings"},
colorDepthTitle: {vi: "Äá»™ sÃ¢u mÃ u", en: "Color Depth"},
detailTitle: {vi: "Chi tiáº¿t", en: "Detail"},
aiTuningTitle: {vi: "Tinh chá»‰nh báº±ng AI", en: "AI Fine-Tuning"},
aiTuningPlaceholder: {vi: "Nháº­p yÃªu cáº§u cá»§a báº¡n á»Ÿ Ä‘Ã¢y... (vÃ­ dá»¥: 'lÃ m cho mÃ u áº¥m hÆ¡n vÃ  trong hÆ¡n')", en: "Enter your request here... (e.g., 'make it warmer and clearer')"},
aiTuningBtn: {vi: "Táº¡o báº±ng AI", en: "Generate with AI"},
aiResultTitle: {vi: "CÃ´ng thá»©c Ä‘Ã£ Ä‘Æ°á»£c AI tinh chá»‰nh:", en: "AI-Adjusted Recipe:"},
compareWithOriginalBtn: {vi: "So sÃ¡nh vá»›i báº£n gá»‘c", en: "Compare with Original"},
aiSuggestionTitle: {vi: "Gá»£i Ã½ cá»§a AI:", en: "AI Suggestion:"},
aiSuggestionText: {vi: "Dá»±a trÃªn yÃªu cáº§u cá»§a báº¡n, cÃ´ng thá»©c nÃ y cÃ³ váº» phÃ¹ há»£p hÆ¡n: ", en: "Based on your request, this recipe might be a better fit: "},
comparisonModalTitle: {vi: "So sÃ¡nh CÃ´ng thá»©c", en: "Recipe Comparison"},
comparisonLoading: {vi: "AI Ä‘ang phÃ¢n tÃ­ch vÃ  so sÃ¡nh...", en: "AI is analyzing and comparing..."},
colorChartTitle: {vi: "Biá»ƒu Ä‘á»“ MÃ u", en: "Color Chart"},
bwChartTitle: {vi: "Biá»ƒu Ä‘á»“ ÄÆ¡n sáº¯c (B&W)", en: "Monochrome (B&W) Chart"},
axisTonality: {vi: "TÆ°Æ¡ng pháº£n (â† Má»m | Cá»©ng â†’)", en: "Tonality (â† Soft | Hard â†’)"},
axisSaturation: {vi: "Äá»™ bÃ£o hÃ²a (â† Tháº¥p | Cao â†’)", en: "Saturation (â† Low | High â†’)"},
axisChroma: {vi: "Äá»™ sÃ¢u mÃ u (â† Tháº¥p | Cao â†’)", en: "Chroma Depth (â† Low | High â†’)"},
backToListBtn: {vi: "â† Quay láº¡i danh sÃ¡ch", en: "â† Back to list"},

// Featured Photos
featuredTitle: {vi: "áº¢nh Ná»•i Báº­t tá»« Cá»™ng Äá»“ng", en: "Featured Photos from the Community"},
featuredCta: {vi: "HÃ£y cÃ¹ng lÃ m cho thÆ° viá»‡n mÃ u cá»§a Alpha AI Color Lab vÃ  group cá»™ng Ä‘á»“ng Sony Alpha Vietnam thÃªm phong phÃº! Chia sáº» áº£nh cá»§a báº¡n kÃ¨m mÃ£ mÃ u (vÃ­ dá»¥: 'SCL-82') Ä‘á»ƒ cÃ¹ng nhau táº¡o nÃªn má»™t khÃ´ng gian Ä‘áº§y cáº£m há»©ng.", en: "Let's enrich the Alpha AI Color Lab gallery and the Sony Alpha Vietnam community group! Share your photos with the color code (e.g., 'SCL-82') to create an inspiring space together."},
featuredAlbumBtn: {vi: "Xem Album & ÄÃ³ng gÃ³p áº¢nh", en: "View Album & Contribute Photos"},

// Explanation Tab
manifestoTitle: { vi: "Gá»­i nhá»¯ng ngÆ°á»i báº¡n Ä‘á»“ng hÃ nh sÃ¡ng táº¡o,", en: "To our creative companions," },
manifestoBody1: { vi: "ChÃºng tÃ´i hiá»ƒu ráº±ng, Ä‘á»‘i vá»›i má»—i ngÆ°á»i cáº§m mÃ¡y, mÃ u sáº¯c khÃ´ng chá»‰ lÃ  má»™t thÃ´ng sá»‘ ká»¹ thuáº­t. ÄÃ³ lÃ  má»™t pháº§n cá»§a cÃ¢u chuyá»‡n, lÃ  cáº£m xÃºc, vÃ  lÃ  ngÃ´n ngá»¯ khÃ´ng lá»i báº¡n dÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i tháº¿ giá»›i.", en: "We understand that, for every photographer, color is more than just a technical parameter. It's part of the story, it's emotion, and it's the non-verbal language you use to communicate with the world." },
manifestoBody2: { vi: "CÃ³ láº½ báº¡n, cÅ©ng nhÆ° chÃºng tÃ´i, Ä‘Ã£ tá»«ng trÄƒn trá»Ÿ trÃªn hÃ nh trÃ¬nh Ä‘i tÃ¬m má»™t mÃ u sáº¯c \"Ä‘á»™c nháº¥t\" cá»§a riÃªng mÃ¬nh. Má»™t hÃ nh trÃ¬nh thÆ°á»ng báº¯t Ä‘áº§u báº±ng viá»‡c cá»‘ gáº¯ng tÃ¡i táº¡o má»™t cÃ´ng thá»©c cÃ³ sáºµn. NhÆ°ng chÃºng tÃ´i tin ráº±ng tiá»m nÄƒng sÃ¡ng táº¡o cá»§a báº¡n khÃ´ng nÃªn bá»‹ giá»›i háº¡n trong báº¥t ká»³ khuÃ´n khá»• nÃ o.", en: "Perhaps you, like us, have wrestled with the journey to find a 'unique' color of your own. A journey that often begins by trying to replicate a pre-existing formula. But we believe your creative potential should not be confined to any framework." },
manifestoBody3: { vi: "VÃ¬ váº­y, táº¡i Alpha AI Color Lab, chÃºng tÃ´i theo Ä‘uá»•i má»™t triáº¿t lÃ½ khÃ¡c biá»‡t: <strong>KhÃ´ng táº¡o ra nhá»¯ng báº£n sao, mÃ  kiáº¿n táº¡o nÃªn nhá»¯ng dáº¥u áº¥n mÃ u sáº¯c mang Ä‘áº­m tÃ­nh cÃ¡ nhÃ¢n.</strong>", en: "Therefore, at Alpha AI Color Lab, we pursue a different philosophy: <strong>We don't create copies; we build personalized color signatures.</strong>" },
manifestoBody4: { vi: "Dá»± Ã¡n nÃ y khÃ´ng ra Ä‘á»i Ä‘á»ƒ \"giáº£ láº­p\" má»™t mÃ u phim cá»¥ thá»ƒ nÃ o. Thay vÃ o Ä‘Ã³, chÃºng tÃ´i xem cÃ´ng cá»¥ Picture Profile máº¡nh máº½ cá»§a Sony nhÆ° má»™t báº£ng mÃ u vÃ´ háº¡n. CÃ¡c chuyÃªn gia cá»§a chÃºng tÃ´i Ä‘Ã£ dÃ nh tÃ¢m huyáº¿t nghiÃªn cá»©u, khÃ´ng pháº£i Ä‘á»ƒ \"sao chÃ©p\", mÃ  Ä‘á»ƒ \"sÃ¡ng tÃ¡c\" â€” khai phÃ¡ nhá»¯ng kháº£ nÄƒng tiá»m áº©n, táº¡o ra cÃ¡c sáº¯c thÃ¡i vÃ  sá»± chuyá»ƒn mÃ u Ä‘á»™c Ä‘Ã¡o mÃ  báº¡n khÃ³ cÃ³ thá»ƒ tÃ¬m tháº¥y á»Ÿ nÆ¡i khÃ¡c.", en: "This project was not born to 'emulate' any specific film stock. Instead, we see Sony's powerful Picture Profile tool as an infinite creative palette. Our experts have dedicated their efforts to research, not to 'imitate', but to 'compose'â€”unlocking hidden potentials to create unique shades and color transitions that you'd be hard-pressed to find elsewhere." },
manifestoBody5: { vi: "Má»—i cÃ´ng thá»©c báº¡n tÃ¬m tháº¥y táº¡i Ä‘Ã¢y khÃ´ng pháº£i lÃ  má»™t bá»™ lá»c cÃ³ sáºµn. ÄÃ³ lÃ  má»™t tÃ¡c pháº©m nguyÃªn báº£n, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘áº§y chá»§ Ã½ Ä‘á»ƒ giÃºp báº¡n kháº³ng Ä‘á»‹nh ngÃ´n ngá»¯ hÃ¬nh áº£nh Ä‘á»™c Ä‘Ã¡o cá»§a riÃªng mÃ¬nh.", en: "Every recipe you find here is not a pre-made filter. It is an original work, intentionally designed to help you assert your own unique visual language." },
manifestoBody6: { vi: "Má»¥c tiÃªu cuá»‘i cÃ¹ng cá»§a chÃºng tÃ´i lÃ  trao cho báº¡n quyá»n nÄƒng Ä‘á»‹nh hÃ¬nh cÃ¢u chuyá»‡n báº±ng mÃ u sáº¯c, truyá»n thÃªm cáº£m há»©ng cho má»—i khung hÃ¬nh ngay tá»« khoáº£nh kháº¯c báº¥m mÃ¡y.", en: "Our ultimate goal is to empower you to shape your own narrative with color, inspiring every frame from the moment you press the shutter." },
manifestoBody7: { vi: "HÃ£y ngá»«ng tÃ¬m kiáº¿m má»™t váº» ngoÃ i cÃ³ sáºµn. HÃ£y báº¯t Ä‘áº§u hÃ nh trÃ¬nh kiáº¿n táº¡o nÃªn dáº¥u áº¥n cá»§a riÃªng báº¡n.", en: "Stop searching for a ready-made look. Start the journey of creating your own signature." },
manifestoSignature: { vi: "TrÃ¢n trá»ng,<br><strong>Sony Alpha Vietnam.</strong>", en: "Sincerely,<br><strong>Sony Alpha Vietnam.</strong>" },

explainHeader: {vi: "LÃ m Chá»§ MÃ u Sáº¯c CÃ¹ng Sony Alpha", en:"Mastering Color with Sony Alpha"},
explainSubtitle: {vi: "HÆ°á»›ng dáº«n toÃ n diá»‡n Ä‘á»ƒ táº¡o ra mÃ u sáº¯c Ä‘áº­m cháº¥t riÃªng cho áº£nh tÄ©nh", en:"A comprehensive guide to creating your unique color signature for stills"},
pillarsTitle: {vi: "Hai Trá»¥ Cá»™t SÃ¡ng Táº¡o MÃ u Sáº¯c", en:"The Two Pillars of Color Creation"},
wbPillarTitle: {vi: "Trá»¥ cá»™t 1: White Balance - Ná»n Táº£ng Cáº£m XÃºc", en:"Pillar 1: White Balance - The Emotional Foundation"},
ppPillarTitle: {vi: "Trá»¥ cá»™t 2: Picture Profile - Táº¡o DÃ¡ng Váº» Phim áº¢nh", en:"Pillar 2: Picture Profile - Crafting the Film Look"},
wbKelvinTitle: {vi: "Nhiá»‡t Äá»™ Kelvin (K): Táº¡o TÃ´ng MÃ u Chá»§ Äáº¡o", en: "Kelvin Temperature (K): Creating the Main Tone"},
wbKelvinDesc: {vi: 'Sá»­ dá»¥ng thang Ä‘o Kelvin nhÆ° má»™t nÃ©t cá» lá»›n Ä‘á»ƒ "nhuá»™m" toÃ n bá»™ khung hÃ¬nh báº±ng tÃ´ng mÃ u áº¥m hoáº·c láº¡nh, Ä‘á»‹nh hÃ¬nh "mood" cho bá»©c áº£nh.', en: 'Use the Kelvin scale like a broad brush to "tint" the entire frame with warm or cool tones, shaping the photo\'s mood.'},
wbShiftTitle: {vi: "LÆ°á»›i Tinh Chá»‰nh (A-B/G-M Shift): ThÃªm Sáº¯c ThÃ¡i Tinh Vi", en:"Fine-Tuning Grid (A-B/G-M Shift): Adding Subtle Hues"},
wbShiftDesc: {vi: 'Náº¿u Kelvin lÃ  nÃ©t cá» lá»›n, lÆ°á»›i tinh chá»‰nh lÃ  cá» tá»‰a. ÄÃ¢y lÃ  chÃ¬a khÃ³a Ä‘á»ƒ mÃ´ phá»ng cÃ¡c loáº¡i phim Ä‘áº·c trÆ°ng báº±ng cÃ¡ch thÃªm cÃ¡c sáº¯c thÃ¡i Há»• phÃ¡ch/Xanh hoáº·c Xanh lÃ¡/TÃ­m.', en: 'If Kelvin is the broad brush, this is the fine-detail brush. It\'s key to simulating specific films by adding Amber/Blue or Green/Magenta tints.'},
ppInfographicTitle: {vi: "Quy trÃ¬nh Tinh chá»‰nh Picture Profile", en:"Picture Profile Adjustment Workflow"},
ppInfographicDesc: {vi: "LÃ m theo cÃ¡c bÆ°á»›c sau Ä‘á»ƒ thiáº¿t láº­p Picture Profile tá»« Ä‘áº§u, cho phÃ©p báº¡n kiá»ƒm soÃ¡t hoÃ n toÃ n giao diá»‡n cuá»‘i cÃ¹ng cá»§a hÃ¬nh áº£nh.", en:"Follow these steps to set up a Picture Profile from scratch, giving you full control over the final look of your image."},
ppItemBlackLevel: {vi: "Black Level (Má»©c Ä‘á»™ Ä‘en)", en: "Black Level"},
ppItemBlackLevelDesc: {vi: "Thiáº¿t láº­p Ä‘iá»ƒm Ä‘en (vÃ¹ng tá»‘i nháº¥t). TÄƒng (+) Ä‘á»ƒ nÃ¢ng vÃ¹ng tá»‘i (táº¡o look 'faded' hoÃ i cá»•), giáº£m (-) Ä‘á»ƒ vÃ¹ng tá»‘i sÃ¢u hÆ¡n (tÄƒng tÆ°Æ¡ng pháº£n).", en: "Sets the black point. Increase (+) to lift shadows (for a 'faded' look), decrease (-) for deeper blacks (more contrast)."},
ppItemGamma: {vi: "Gamma", en: "Gamma"},
ppItemGammaDesc: {vi: "Thiáº¿t láº­p Ä‘Æ°á»ng cong tÆ°Æ¡ng pháº£n (contrast curve). ÄÃ¢y lÃ  ná»n táº£ng cho 'look' cá»§a báº¡n. Still & Movie cho Ä‘á»™ tÆ°Æ¡ng pháº£n cao, trong khi cÃ¡c gamma Cine/S-Log cho dáº£i nháº¡y sÃ¡ng rá»™ng hÆ¡n.", en: "Sets the contrast curve. This is the foundation of your look. Still & Movie are punchy, while Cine/S-Log gammas offer wider dynamic range."},
ppItemBlackGamma: {vi: "Black Gamma", en: "Black Gamma"},
ppItemBlackGammaDesc: {vi: "Tinh chá»‰nh Ä‘Æ°á»ng cong tÆ°Æ¡ng pháº£n á»Ÿ vÃ¹ng tá»‘i. 'Wide' áº£nh hÆ°á»Ÿng vÃ¹ng rá»™ng hÆ¡n, 'Narrow' áº£nh hÆ°á»Ÿng vÃ¹ng háº¹p hÆ¡n.", en: "Fine-tunes the contrast curve in the shadow areas. 'Wide' affects a broader range, 'Narrow' affects a smaller range."},
ppItemKnee: {vi: "Knee (Äiá»ƒm uá»‘n)", en: "Knee"},
ppItemKneeDesc: {vi: "Kiá»ƒm soÃ¡t Ä‘á»™ nÃ©n á»Ÿ vÃ¹ng sÃ¡ng (highlight) Ä‘á»ƒ trÃ¡nh bá»‹ 'chÃ¡y'. Cháº¿ Ä‘á»™ tá»± Ä‘á»™ng (Auto) hoáº¡t Ä‘á»™ng tá»‘t, cháº¿ Ä‘á»™ thá»§ cÃ´ng (Manual) cho phÃ©p kiá»ƒm soÃ¡t chÃ­nh xÃ¡c hÆ¡n.", en: "Controls highlight compression to prevent 'clipping'. Auto mode works well; Manual mode gives precise control."},
ppItemColorMode: {vi: "Color Mode (Cháº¿ Ä‘á»™ mÃ u)", en: "Color Mode"},
ppItemColorModeDesc: {vi: "XÃ¡c Ä‘á»‹nh cÃ¡ch mÃ u sáº¯c Ä‘Æ°á»£c tÃ¡i táº¡o. NÃªn chá»n cháº¿ Ä‘á»™ phÃ¹ há»£p vá»›i Gamma Ä‘Ã£ chá»n (vÃ­ dá»¥: Cine4 vá»›i Pro/Cinema, S-Log3 vá»›i S-Gamut3.Cine).", en: "Determines how colors are reproduced. Should be matched with the chosen Gamma (e.g., Cine4 with Pro/Cinema, S-Log3 with S-Gamut3.Cine)."},
ppItemSaturation: {vi: "Saturation (BÃ£o hÃ²a)", en: "Saturation"},
ppItemSaturationDesc: {vi: "Äiá»u chá»‰nh Ä‘á»™ Ä‘áº­m/nháº¡t tá»•ng thá»ƒ cá»§a táº¥t cáº£ cÃ¡c mÃ u.", en: "Adjusts the overall intensity of all colors."},
ppItemColorPhase: {vi: "Color Phase (Pha mÃ u)", en: "Color Phase"},
ppItemColorPhaseDesc: {vi: "Xoay trá»¥c mÃ u sáº¯c tá»•ng thá»ƒ. Há»¯u Ã­ch Ä‘á»ƒ tinh chá»‰nh nháº¹ toÃ n bá»™ tÃ´ng mÃ u mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n tá»«ng mÃ u riÃªng láº».", en: "Shifts the overall hue of all colors. Useful for subtle, global color tone adjustments without affecting individual colors."},
ppItemColorDepth: {vi: "Color Depth (Äá»™ sÃ¢u mÃ u)", en: "Color Depth"},
ppItemColorDepthDesc: {vi: "CÃ´ng cá»¥ máº¡nh máº½ nháº¥t. TÄƒng/giáº£m Ä‘á»™ sÃ¡ng cá»§a tá»«ng kÃªnh mÃ u riÃªng láº» (Äá», Lá»¥c, Lam, Lá»¥c lam, TÃ­m, VÃ ng).", en: "The most powerful tool. Increases/decreases the brightness of individual color channels (R, G, B, C, M, Y)."},
ppItemDetail: {vi: "Detail (Chi tiáº¿t)", en: "Detail"},
ppItemDetailDesc: {vi: "Kiá»ƒm soÃ¡t Ä‘á»™ sáº¯c nÃ©t. Äá»ƒ cÃ³ 'look' phim má»m máº¡i, hÃ£y giáº£m máº¡nh (vÃ­ dá»¥: -7).", en: "Controls the sharpening. For a soft, filmic look, decrease it significantly (e.g., -7)."},
recallTitle: { vi: 'LÆ°u Trá»¯ & TÃ¡i Sá»­ Dá»¥ng: LÃ m Chá»§ Memory Recall', en: 'Save & Reuse: Mastering Memory Recall' },
recallDesc: { vi: 'Äá»«ng lÃ£ng phÃ­ cÃ´ng sá»©c! LÆ°u láº¡i cÃ¡c cÃ´ng thá»©c cá»§a báº¡n vÃ o bá»™ nhá»› cá»§a mÃ¡y áº£nh Ä‘á»ƒ gá»i ra nhanh chÃ³ng chá»‰ báº±ng má»™t thao tÃ¡c xoay nÃºt.', en: 'Don\'t waste your effort! Save your recipes to the camera\'s memory for quick recall with a simple turn of a dial.' },
recallInternalTitle: { vi: 'Bá»™ Nhá»› Trong (1, 2, 3)', en: 'Internal Memory (1, 2, 3)' },
recallInternalDesc: { vi: 'LÆ°u trá»±c tiáº¿p vÃ o mÃ¡y. Truy cáº­p nhanh nháº¥t báº±ng cÃ¡ch xoay vÃ²ng xoay cháº¿ Ä‘á»™. LÃ½ tÆ°á»Ÿng cho cÃ¡c cÃ´ng thá»©c báº¡n sá»­ dá»¥ng hÃ ng ngÃ y.', en: 'Saves directly to the camera. Quickest access via the mode dial. Ideal for your daily-use recipes.' },
recallCardTitle: { vi: 'Tháº» Nhá»› (M1, M2, M3, M4)', en: 'Memory Card (M1, M2, M3, M4)' },
recallCardDesc: { vi: 'LÆ°u dÆ°á»›i dáº¡ng file trÃªn tháº» nhá»›. Cá»±c ká»³ há»¯u Ã­ch Ä‘á»ƒ sao lÆ°u an toÃ n hoáº·c chuyá»ƒn cÃ´ng thá»©c sang má»™t thÃ¢n mÃ¡y Sony khÃ¡c.', en: 'Saves as a file on your memory card. Extremely useful for backups or transferring recipes to another Sony camera body.' },
tutorialTitle: { vi: "HÆ°á»›ng dáº«n CÃ i Ä‘áº·t Nhanh", en: "Quick Setup Guide" },
tutorialStep1Title: { vi: "BÆ°á»›c 1: TÃ¬m Picture Profile", en: "Step 1: Find Picture Profile" },
tutorialStep1P1: { vi: "<strong>MÃ¡y áº£nh Ä‘á»i má»›i:</strong> Menu â†’ Exposure/Color (biá»ƒu tÆ°á»£ng mÃ¡y áº£nh) â†’ Color/Tone â†’ Picture Profile.", en: "<strong>Newer Cameras:</strong> Menu â†’ Exposure/Color (camera icon) â†’ Color/Tone â†’ Picture Profile." },
tutorialStep1P2: { vi: "<strong>MÃ¡y áº£nh Ä‘á»i cÅ©:</strong> Menu â†’ Color/WB/Img. Processing (biá»ƒu tÆ°á»£ng báº£ng mÃ u) â†’ Picture Profile.", en: "<strong>Older Cameras:</strong> Menu â†’ Color/WB/Img. Processing (palette icon) â†’ Picture Profile." },
tutorialStep2Title: { vi: "BÆ°á»›c 2: Chá»n vÃ  Reset", en: "Step 2: Select & Reset" },
tutorialStep2P1: { vi: "Chá»n má»™t profile trá»‘ng (vÃ­ dá»¥: PP10), Ä‘i vÃ o trong vÃ  nháº¥n nÃºt 'XoÃ¡' Ä‘á»ƒ reset vá» máº·c Ä‘á»‹nh.", en: "Choose an empty profile (e.g., PP10), enter it, and press the 'Delete' button to reset it to default." },
tutorialStep3Title: { vi: "BÆ°á»›c 3: Nháº­p thÃ´ng sá»‘", en: "Step 3: Enter Parameters" },
tutorialStep3P1: { vi: "Cáº©n tháº­n nháº­p táº¥t cáº£ cÃ¡c thÃ´ng sá»‘ cá»§a cÃ´ng thá»©c, tá»« Black Level Ä‘áº¿n Detail.", en: "Carefully enter all parameters from the recipe, from Black Level to Detail." },
tutorialStep4Title: { vi: "BÆ°á»›c 4: CÃ i Ä‘áº·t White Balance", en: "Step 4: Set White Balance" },
tutorialStep4P1: { vi: "ThoÃ¡t khá»i Picture Profile, vÃ o má»¥c <strong>White Balance</strong> vÃ  chá»‰nh theo nhiá»‡t Ä‘á»™ K vÃ  WB Shift (Color Filter) Ä‘Æ°á»£c ghi trong cÃ´ng thá»©c.", en: "Exit Picture Profile, go to <strong>White Balance</strong>, and adjust the Kelvin temperature and WB Shift (Color Filter) as specified in the recipe." },
exposureNoteTitle: { vi: "LÆ°u Ã½ vá» PhÆ¡i sÃ¡ng", en: "Note on Exposure" },
exposureNoteDesc: { vi: "Háº§u háº¿t cÃ¡c cÃ´ng thá»©c Ä‘Æ°á»£c tá»‘i Æ°u khi chá»¥p á»Ÿ má»©c phÆ¡i sÃ¡ng 0EV vá»›i cháº¿ Ä‘á»™ Ä‘o sÃ¡ng 'ToÃ n mÃ n hÃ¬nh trung bÃ¬nh' (Entire Screen Avg.). CÃ¡c cÃ´ng thá»©c dá»±a trÃªn S-Log cÃ³ thá»ƒ cáº§n tÄƒng phÆ¡i sÃ¡ng (overexpose) Ä‘á»ƒ cÃ³ káº¿t quáº£ tá»‘t nháº¥t.", en: "Most recipes are optimized for 0EV exposure with 'Entire Screen Avg.' metering mode. Recipes based on S-Log may require overexposure for best results." },

// Quiz Questions
quizQ1: {vi: "Chá»§ Ä‘á» báº¡n sáº¯p chá»¥p lÃ  gÃ¬?", en: "What's your subject?"},
quizQ1A1: {vi: "ChÃ¢n dung", en: "Portrait"},
quizQ1A2: {vi: "Phong cáº£nh", en: "Landscape"},
quizQ1A3: {vi: "ÄÆ°á»ng phá»‘ / ÄÃ´ thá»‹", en: "Street / Urban"},
quizQ1A4: {vi: "Äá»i thÆ°á»ng", en: "Everyday"},
quizQ2: {vi: "Báº¡n muá»‘n tÃ´ng mÃ u chá»§ Ä‘áº¡o nÃ o?", en: "What's your desired primary tone?"},
quizQ2A1: {vi: "áº¤m Ã¡p (VÃ ng, Cam)", en: "Warm (Yellow, Orange)"},
quizQ2A2: {vi: "MÃ¡t máº» (Xanh dÆ°Æ¡ng)", en: "Cool (Blue)"},
quizQ2A3: {vi: "Tá»± nhiÃªn", en: "Natural"},
quizQ2A4: {vi: "HoÃ i cá»• (Film)", en: "Nostalgic (Film)"},
quizQ3: {vi: "Äá»™ tÆ°Æ¡ng pháº£n báº¡n thÃ­ch?", en: "How about the contrast?"},
quizQ3A1: {vi: "Cao (Gáº¯t)", en: "High (Punchy)"},
Q3A2: {vi: "Tháº¥p (Má»m máº¡i)", en: "Low (Soft)"},
quizQ3A3: {vi: "Trung bÃ¬nh", en: "Medium"},
quizQ4: {vi: "Báº¡n thÃ­ch áº£nh mÃ u hay tráº¯ng Ä‘en?", en: "Color or Black & White?"},
quizQ4A1: {vi: "áº¢nh mÃ u", en: "Color"},
quizQ4A2: {vi: "áº¢nh tráº¯ng Ä‘en", en: "Black & White"},
quizQ5: {vi: "Äá»™ bÃ£o hÃ²a mÃ u sáº¯c báº¡n muá»‘n?", en: "What's your preferred saturation?"},
quizQ5A1: {vi: "Äáº­m", en: "High"},
quizQ5A2: {vi: "Trung bÃ¬nh", en: "Medium"},
quizQ5A3: {vi: "Nháº¡t", en: "Low"},
};

const quizQuestions = [
{Â 
id: 'subject',Â 
title: 'quizQ1',Â 
options: [
{ key: 'quizQ1A1', value: 'portrait', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/></svg>` },
{ key: 'quizQ1A2', value: 'landscape', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.59a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>` },
{ key: 'quizQ1A3', value: 'urban', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/><path d="M16 14h.01"/></svg>` },
{ key: 'quizQ1A4', value: 'everyday', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 9 3-3 3 3"/><path d="M13 18V2H7"/><path d="M22 15l-3 3-3-3"/><path d="m11 6 10 12"/></svg>` }
]Â 
},
{Â 
id: 'tone',Â 
title: 'quizQ2',Â 
options: [
{ key: 'quizQ2A1', value: 'warm', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>` },
{ key: 'quizQ2A2', value: 'cool', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a7 7 0 0 0-7 7c0 2.4 1.2 4.5 3 5.7L12 22l4-7.3c1.8-1.2 3-3.3 3-5.7a7 7 0 0 0-7-7z"/><path d="M12 9a3 3 0 0 0-3 3c0 1.2.8 2.2 2 2.7l1 1.3l1-1.3c1.2-.5 2-1.5 2-2.7a3 3 0 0 0-3-3z"/></svg>` },
{ key: 'quizQ2A3', value: 'green', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c-2 0-4-1-4-4 0-2 2-3 4-3s4 1 4 3c0 3-2 4-4 4z"/><path d="M12 15V2"/><path d="m5 12-3-3 3-3"/><path d="m19 12 3-3-3-3"/></svg>` },
{ key: 'quizQ2A4', value: 'vintage', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h4"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M21 7.5h-4"/><path d="M21 12h-4"/><path d="M21 16.5h-4"/></svg>` }
]Â 
},
{Â 
id: 'contrast',Â 
title: 'quizQ3',Â 
options: [
{ key: 'quizQ3A1', value: 'high', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 18a6 6 0 0 0 0-12v12z"/></svg>` },
{ key: 'quizQ3A2', value: 'low', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" fill="currentColor" fill-opacity="0.2"/><path d="M12 18a6 6 0 0 0 0-12v12z"/></svg>` },
{ key: 'quizQ3A3', value: 'medium', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 18a6 6 0 0 0 0-12v12z" fill="currentColor" fill-opacity="0.5"/></svg>` }
]Â 
},
{
id: 'type',
title: 'quizQ4',
options: [
{ key: 'quizQ4A1', value: 'color', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0L12 2.69z"></path></svg>` },
{ key: 'quizQ4A2', value: 'bw', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>` }
]
},
{
id: 'saturation',
title: 'quizQ5',
options: [
{ key: 'quizQ5A1', value: 'high', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>` },
{ key: 'quizQ5A2', value: 'medium', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2v20"/></svg>` },
{ key: 'quizQ5A3', value: 'low', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>` }
]
}
];

async function callAIApi(prompt, isStructured = false) {
Â  Â  if (state.isAILoading) return;
Â  Â  state.isAILoading = true;
Â  Â  let result = null;

Â  Â  try {
Â  Â  Â  Â  let chatHistory = [];
Â  Â  Â  Â  chatHistory.push({ role: "user", parts: [{ text: prompt }] });

Â  Â  Â  Â  let payload = { contents: chatHistory };
Â  Â  Â  Â  const apiKey = "AIzaSyDxctVkghoMzVFNTLbIfHmHQ_szw-omYbQ"; // Sá»­ dá»¥ng API Key cá»§a báº¡n

Â  Â  Â  Â  if (isStructured) {
Â  Â  Â  Â  Â  Â  // Define schema for structured output (e.g., quiz results or adjusted recipe)
Â  Â  Â  Â  Â  Â  if (prompt.startsWith("Based on tags:")) {
Â  Â  Â  Â  Â  Â  Â  Â  payload.generationConfig = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseMimeType: "application/json",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseSchema: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "ARRAY",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  items: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "recipeId": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "moodDescription": { "type": "STRING" }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "propertyOrdering": ["recipeId", "moodDescription"]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  } else if (prompt.includes("adjusted settings")) {
Â  Â  Â  Â  Â  Â  Â  Â  payload.generationConfig = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseMimeType: "application/json",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseSchema: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "recipe": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "id": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": { "type": "OBJECT", "properties": { "vi": { "type": "STRING" }, "en": { "type": "STRING" } } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "description": { "type": "OBJECT", "properties": { "vi": { "type": "STRING" }, "en": { "type": "STRING" } } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "type": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "contrast": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "saturation": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "tags": { "type": "ARRAY", "items": { "type": "STRING" } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "whiteBalance": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "settings": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "type": "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "properties": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Black level": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Gamma": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Black Gamma": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Knee": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Color Mode": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Saturation": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Color Phase": { "type": "STRING" }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "colorDepth": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "type": "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "properties": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "R": { "type": "STRING" }, "G": { "type": "STRING" }, "B": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "C": { "type": "STRING" }, "M": { "type": "STRING" }, "Y": { "type": "STRING" }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "detailSettings": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "type": "OBJECT",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "properties": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Level": { "type": "STRING" }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "personalityColor": { "type": "STRING" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "coords": { "type": "OBJECT", "properties": { "x": { "type": "NUMBER" }, "y": { "type": "NUMBER" } } }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
Â  Â  Â  Â  const response = await fetch(apiUrl, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  });

Â  Â  Â  Â  const responseData = await response.json();

Â  Â  Â  Â  if (responseData.candidates && responseData.candidates.length > 0 &&
Â  Â  Â  Â  Â  Â  responseData.candidates[0].content && responseData.candidates[0].content.parts &&
Â  Â  Â  Â  Â  Â  responseData.candidates[0].content.parts.length > 0) {
Â  Â  Â  Â  Â  Â  const text = responseData.candidates[0].content.parts[0].text;
Â  Â  Â  Â  Â  Â  if (isStructured) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  result = JSON.parse(text);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to parse JSON response from AI:", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  result = null;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  result = text;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.error("Unexpected AI response structure:", responseData);
Â  Â  Â  Â  Â  Â  result = null;
Â  Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("AI API call failed:", error);
Â  Â  Â  Â  result = null;
Â  Â  } finally {
Â  Â  Â  Â  state.isAILoading = false;
Â  Â  Â  Â  updateUIAfterAILoading();
Â  Â  Â  Â  return result;
Â  Â  }
}

function t(key) { return translations[key]?.[state.currentLang] || key; }

function applyTranslations() {
document.querySelectorAll('[data-translate-key]').forEach(el => {
const key = el.dataset.translateKey;
if (translations[key] && translations[key][state.currentLang]) {
if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { el.placeholder = t(key); }Â  Â Â 
else if (el.tagName === 'OPTION') { el.textContent = t(key); }Â  Â Â 
else { el.innerHTML = t(key); }
}
});
document.querySelectorAll('.nav-btn-mobile').forEach(btn => {
const key = 'nav' + btn.dataset.view.charAt(0).toUpperCase() + btn.dataset.view.slice(1);
btn.textContent = t(key);
});
document.getElementById('langVI').classList.toggle('active', state.currentLang === 'vi');
document.getElementById('langEN').classList.toggle('active', state.currentLang === 'en');
}

function createSettingsGrid(settings) {
if (!settings) return '';
return Object.entries(settings).map(([key, value]) => `<div class="flex flex-col"><span class="text-xs text-neutral-500">${key}</span><span class="font-semibold text-lg">${value}</span></div>`).join('');
};

function createFullRecipeHTML(recipe, isMainView = false) {
const titleClass = isMainView ? 'text-xl font-bold' : 'text-lg font-bold';
const noteHTML = (recipe.notes && recipe.notes[state.currentLang])Â  Â 
? `<div class="mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="font-bold" data-translate-key="noteTitle"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p>${recipe.notes[state.currentLang]}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>` : '';

return `${noteHTML}<div class="space-y-6 mt-6">
Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="${titleClass} mb-2" data-translate-key="whiteBalanceTitle"></h4><div class="p-4 bg-black/5 rounded-xl"><p class="font-semibold text-lg">${recipe.whiteBalance || ''}</p></div></div>
Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="${titleClass} mb-2" data-translate-key="recipeSettingsTitle"></h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-5 p-5 bg-black/5 rounded-xl">${createSettingsGrid(recipe.settings)}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â ${recipe.colorDepth ? `<div><h4 class="${titleClass} mb-2" data-translate-key="colorDepthTitle"></h4><div class="grid grid-cols-3 sm:grid-cols-6 gap-x-6 gap-y-5 p-5 bg-black/5 rounded-xl">${createSettingsGrid(recipe.colorDepth)}</div></div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â ${recipe.detailSettings ? `<div><h4 class="${titleClass} mb-2" data-translate-key="detailTitle"></h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-5 p-5 bg-black/5 rounded-xl">${createSettingsGrid(recipe.detailSettings)}</div></div>` : ''}
Â  Â  Â  Â  Â  Â </div>`;
}

function updateUIAfterAILoading() {
document.querySelectorAll('button:disabled').forEach(btn => {
if (btn.querySelector('.spinner')) {
btn.innerHTML = btn.dataset.originalText || '';
btn.disabled = false;
}
});
}

const viewTemplates = {
home: () => `<div id="homeView" class="w-full h-full flex flex-col items-center justify-center text-center absolute inset-0 view-transition p-4">
Â  Â  Â  Â  Â  Â  Â  Â <h1 data-translate-key="landingTitle" class="landing-title"></h1>
Â  Â  Â  Â  Â  Â  Â  Â <p data-translate-key="landingSubtitle" class="landing-subtitle"></p>
Â  Â  Â  Â  Â  Â  Â  Â <button id="startQuizBtn" class="btn btn-primary mt-10 py-4 px-10 text-lg" data-translate-key="startQuizBtn"></button>
Â  Â  Â  Â  Â  Â </div>`,

quiz: () => {
const quizHTML = quizQuestions.map(q => {
const optionsHTML = q.options.map(opt => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="quiz-option-card" data-value="${opt.value}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${opt.icon}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span data-translate-key="${opt.key}"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`).join('');
const gridCols = q.options.length > 3 ? 'grid-cols-2 lg:grid-cols-4' : (q.options.length === 2 ? 'grid-cols-2' : 'grid-cols-1 sm:grid-cols-3');
return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="mb-12" data-quiz-group="${q.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl font-bold text-center mb-6" data-translate-key="${q.title}"></h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid ${gridCols} gap-4">${optionsHTML}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`;
}).join('');

return `<div id="quizView" class="w-full h-full absolute inset-0 overflow-y-auto view-transition p-6 md:p-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="max-w-4xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${quizHTML}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="submitQuizBtn" class="btn btn-primary py-4 px-12 text-xl" disabled>Xem káº¿t quáº£</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â </div>`;
},

recipeFormulas: () => `
Â  Â  Â  Â  Â  Â  Â  Â <div id="recipeFormulasView" class="w-full h-full flex flex-col md:flex-row gap-6 absolute inset-0 view-transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- Left Panel: Recipe List & Mobile Filters -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <aside id="recipeListPanel" class="w-full md:w-1/3 lg:w-[30%] xl:w-1/4 glass-panel p-4 md:p-6 flex flex-col flex-shrink-0 md:flex">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-2xl md:text-3xl font-bold" data-translate-key="sidebarTitle"></h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="search" id="searchInput" class="w-full p-3 my-4 rounded-xl bg-gray-200/50 border-2 border-transparent focus:border-blue-500 focus:bg-white transition-all" data-translate-key="searchInputPlaceholder">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- FILTERS FOR MOBILE - hidden on medium screens and up -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-4 text-sm mb-4 md:hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h4 class="font-semibold mb-2" data-translate-key="filterType"></h4><div class="flex gap-2" data-filter-group="type"><button class="filter-btn flex-1 py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterTypeColor" data-filter-value="color"></button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterTypeBW" data-filter-value="bw"></button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h4 class="font-semibold mb-2" data-translate-key="filterContrast"></h4><div class="flex gap-2" data-filter-group="contrast"><button class="filter-btn flex-1 py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterHigh" data-filter-value="high"></button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterMedium" data-filter-value="medium"></button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterLow" data-filter-value="low"></button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h4 class="font-semibold mb-2" data-translate-key="filterSaturation"></h4><div class="flex gap-2" data-filter-group="saturation"><button class="filter-btn flex-1 py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterHigh" data-filter-value="high"></button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterMedium" data-filter-value="medium"></button><button class="filter-btn flex-1 py-2 px-3 rounded-full" data-translate-key="filterLow" data-filter-value="low"></button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- The recipe list itself -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="recipeListContainer" class="space-y-2 md:pt-0 pt-4 border-t md:border-t-0 flex-grow overflow-y-auto pr-2 -mr-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- Compare button at the bottom -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="compareBtnContainer" class="pt-4 flex-shrink-0 border-t mt-auto"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </aside>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- Right Panel: Details, Charts, and now Desktop Filters -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <main id="recipeMainPanel" class="w-full md:w-2/3 lg:w-[70%] xl:w-3/4 flex-col min-h-0 hidden md:flex">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- FILTERS FOR DESKTOP - hidden on small screens -->
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="filtersContainerDesktop" class="glass-panel p-4 mb-6 hidden md:flex flex-wrap items-center gap-x-6 gap-y-3 text-sm">
Â  <div class="flex items-center gap-3"><h4 class="font-semibold shrink-0" data-translate-key="filterType"></h4><div class="flex gap-2" data-filter-group="type"><button class="filter-btn py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterTypeColor" data-filter-value="color"></button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterTypeBW" data-filter-value="bw"></button></div></div>
Â  <div class="flex items-center gap-3"><h4 class="font-semibold shrink-0" data-translate-key="filterContrast"></h4><div class="flex gap-2" data-filter-group="contrast"><button class="filter-btn py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterHigh" data-filter-value="high"></button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterMedium" data-filter-value="medium"></button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterLow" data-filter-value="low"></button></div></div>
Â  <div class="flex items-center gap-3"><h4 class="font-semibold shrink-0" data-translate-key="filterSaturation"></h4><div class="flex gap-2" data-filter-group="saturation"><button class="filter-btn py-2 px-3 rounded-full active" data-filter-value="all">All</button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterHigh" data-filter-value="high"></button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterMedium" data-filter-value="medium"></button><button class="filter-btn py-2 px-3 rounded-full" data-translate-key="filterLow" data-filter-value="low"></button></div></div>
</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel flex-grow overflow-y-auto p-6 lg:p-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="chartsContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl md:text-3xl font-bold text-gray-700" data-translate-key="recipeDetailWelcomeTitle"></h2><p class="text-neutral-500 mt-2 max-w-xl mx-auto" data-translate-key="recipeDetailWelcomeText"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h3 class="text-xl font-bold text-center mb-4" data-translate-key="colorChartTitle"></h3><div class="chart-container"><canvas id="colorChart"></canvas></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h3 class="text-xl font-bold text-center mb-4" data-translate-key="bwChartTitle"></h3><div class="chart-container"><canvas id="bwChart"></canvas></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="recipeContent" class="hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </main>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="recipeDetailPanelMobile" class="w-full h-full absolute inset-0 bg-[#f4f7fc] p-4 overflow-y-auto hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="backToListBtn" class="btn bg-gray-200 text-gray-800 mb-4 p-4" data-translate-key="backToListBtn"></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-6 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="recipeContentMobile"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â </div>`,

featuredPhotos: () => `<div id="featuredPhotosView" class="w-full h-full absolute inset-0 overflow-y-auto view-transition p-4">
Â  Â <div class="glass-panel p-6 md:p-12 text-center max-w-5xl mx-auto">
Â  Â  Â  Â <h2 class="text-2xl md:text-4xl font-bold" data-translate-key="featuredTitle"></h2>
Â  Â  Â  Â <p class="text-base md:text-lg text-neutral-600 mt-4 max-w-3xl mx-auto" data-translate-key="featuredCta"></p>
Â  Â  Â  Â <a href="https://www.facebook.com/media/set?set=oa.31406519995613930&type=3" target="_blank" rel="noopener noreferrer" class="btn btn-primary mt-8 py-3 px-8 text-base md:text-lg">
Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M12 2L12 11M12 11L15 8M12 11L9 8"/><path d="M20 13.33V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H10.67" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
Â  Â  Â  Â  Â  Â <span data-translate-key="featuredAlbumBtn"></span>
Â  Â  Â  Â </a>
Â  Â  Â  Â <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-10">
Â  Â  Â  Â  Â  Â ${recipesData.slice(0,6).map((recipe) => {
Â  Â  Â  Â  Â  Â  Â  Â const hasDemoImages = recipe.demoImages && recipe.demoImages.length > 0;
Â  Â  Â  Â  Â  Â  Â  Â  const imgSrc = hasDemoImages ? recipe.demoImages[0] : `https://placehold.co/800x600/${recipe.personalityColor.substring(1)}/ffffff?text=${encodeURIComponent(recipe.name[state.currentLang])}`;
Â  Â  Â  Â  Â  Â  Â  Â return `<div class="bg-gray-200 group rounded-xl overflow-hidden cursor-pointer lightbox-trigger-thumb" data-recipe-id="${recipe.id}" data-index="0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${imgSrc}" alt="áº¢nh demo cÃ´ng thá»©c ${recipe.name[state.currentLang]}" class="aspect-video w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300" loading="lazy">
Â  Â  Â  Â  Â  Â  Â  Â </div>`;
Â  Â  Â  Â  Â  Â }).join('')}
Â  Â  Â  Â </div>
Â  Â </div>
</div>`,

explain: () => `
Â  Â  Â  Â  Â  Â <div id="explainView" class="w-full h-full absolute inset-0 overflow-y-auto view-transition bg-slate-50 text-gray-800">
Â  Â  Â  Â  Â  Â  Â  Â <div class="container mx-auto p-4 sm:p-6 md:p-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <header class="text-center mb-12 md:mb-16 pt-4 md:pt-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h1 class="text-3xl md:text-5xl font-extrabold text-slate-800 mb-2" data-translate-key="explainHeader"></h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2 class="text-lg md:text-xl text-slate-600 max-w-3xl mx-auto" data-translate-key="explainSubtitle"></h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </header>
Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <main class="space-y-12 md:space-y-20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <section>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-2xl md:text-3xl font-bold text-center mb-8" data-translate-key="pillarsTitle"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="text-xl font-bold mb-6 text-center" data-translate-key="wbPillarTitle"></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h5 class="font-bold text-lg" data-translate-key="wbKelvinTitle"></h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-gray-600 mb-3" data-translate-key="wbKelvinDesc"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="w-full h-8 rounded-full bg-gradient-to-r from-blue-400 via-white to-orange-400 flex justify-between items-center px-2 text-xs font-bold text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>2500K</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>5500K</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>9900K</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h5 class="font-bold text-lg" data-translate-key="wbShiftTitle"></h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-gray-600 mb-3" data-translate-key="wbShiftDesc"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="abgm-grid-interactive-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="abgm-grid" class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="absolute top-1/2 -left-5 -translate-y-1/2 font-bold text-blue-600">B</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="absolute top-1/2 -right-5 -translate-y-1/2 font-bold text-amber-600">A</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="absolute left-1/2 -top-5 -translate-x-1/2 font-bold text-green-600">G</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="absolute left-1/2 -bottom-5 -translate-x-1/2 font-bold text-purple-600">M</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="abgm-pointer" style="top: 50%; left: 50%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="abgm-values" class="text-center mt-2 font-mono font-semibold bg-slate-100 p-2 rounded-md">A-B: 0, G-M: 0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="text-xl font-bold mb-6 text-center" data-translate-key="ppPillarTitle"></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-sm text-gray-700 mb-6 text-center">Picture Profile lÃ  má»™t há»‡ thá»‘ng menu tÃ­ch há»£p trong mÃ¡y áº£nh Sony, cung cáº¥p má»™t loáº¡t cÃ¡c thÃ´ng sá»‘ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘iá»u chá»‰nh hÃ¬nh áº£nh vÃ  video ngay bÃªn trong mÃ¡y áº£nh trÆ°á»›c khi chÃºng Ä‘Æ°á»£c xá»­ lÃ½ vÃ  nÃ©n. CÃ¡c thÃ´ng sá»‘ nÃ y cho phÃ©p thay Ä‘á»•i cÃ¡c cÃ i Ä‘áº·t liÃªn quan Ä‘áº¿n mÃ u sáº¯c, Ä‘á»™ chuyá»ƒn tÃ´ng, Ä‘á»™ tÆ°Æ¡ng pháº£n vÃ  Ä‘á»™ sáº¯c nÃ©t cá»§a hÃ¬nh áº£nh.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <details class="pp-infographic-item"><summary class="font-bold cursor-pointer">1. <span data-translate-key="ppItemGamma"></span></summary><p class="text-sm text-gray-600 mt-2">Gamma thiáº¿t láº­p Ä‘á»™ dá»‘c (Ä‘Æ°á»ng cong tÆ°Æ¡ng pháº£n), xÃ¡c Ä‘á»‹nh má»‘i quan há»‡ giá»¯a má»©c tÃ­n hiá»‡u Ä‘áº§u vÃ o (Ä‘á»™ sÃ¡ng tá»« Ä‘á»‘i tÆ°á»£ng) vÃ  má»©c tÃ­n hiá»‡u Ä‘áº§u ra (Ä‘á»™ sÃ¡ng Ä‘Æ°á»£c tÃ¡i táº¡o bá»Ÿi mÃ¡y áº£nh hoáº·c mÃ n hÃ¬nh hiá»ƒn thá»‹). HÃ¬nh dáº¡ng cá»§a Ä‘Æ°á»ng cong gamma áº£nh hÆ°á»Ÿng Ä‘Ã¡ng ká»ƒ Ä‘áº¿n Ä‘áº·c Ä‘iá»ƒm hÃ¬nh áº£nh, Ä‘áº·c biá»‡t lÃ  á»Ÿ cÃ¡c vÃ¹ng tá»‘i vÃ  Ä‘á»™ tÆ°Æ¡ng pháº£n tá»•ng thá»ƒ. CÃ¡c Ä‘Æ°á»ng cong Cine, S-Cinetone vÃ  HLG ná»•i báº­t nhÆ° nhá»¯ng á»©ng cá»­ viÃªn chÃ­nh cho cÃ¡c giao diá»‡n Ä‘iá»‡n áº£nh "tá»©c thÃ¬", mang láº¡i sá»± cÃ¢n báº±ng giá»¯a dáº£i Ä‘á»™ng vÃ  Ä‘á»™ tÆ°Æ¡ng pháº£n dá»… chá»‹u ngay tá»« mÃ¡y áº£nh. S-Log khÃ´ng dÃ nh cho viá»‡c sá»­ dá»¥ng "tá»©c thÃ¬", Ä‘áº·c biá»‡t lÃ  trÃªn cÃ¡c mÃ¡y áº£nh 8 bit do nhiá»…u vÃ  tÃ­nh dá»… vá»¡ cá»§a nÃ³.</p></details>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <details class="pp-infographic-item"><summary class="font-bold cursor-pointer">2. <span data-translate-key="ppItemColorMode"></span></summary><p class="text-sm text-gray-600 mt-2">Color Mode xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘áº·c tÃ­nh mÃ u sáº¯c, hoáº¡t Ä‘á»™ng káº¿t há»£p vá»›i Gamma Ä‘á»ƒ thiáº¿t láº­p mÃ u sáº¯c cÆ¡ báº£n cá»§a hÃ¬nh áº£nh. Gamma xÃ¡c Ä‘á»‹nh Ä‘Æ°á»ng cong Ä‘á»™ sÃ¡ng, trong khi Color Mode xÃ¡c Ä‘á»‹nh sáº¯c Ä‘á»™. CÃ¹ng vá»›i nhau, chÃºng thiáº¿t láº­p "giao diá»‡n" cÆ¡ báº£n cá»§a hÃ¬nh áº£nh. Viá»‡c chá»n Ä‘Ãºng Color Mode lÃ  ráº¥t quan trá»ng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¡c tÃ­nh tháº©m má»¹ cá»¥ thá»ƒ.</p></details>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <details class="pp-infographic-item"><summary class="font-bold cursor-pointer">3. <span data-translate-key="ppItemBlackLevel"></span></summary><p class="text-sm text-gray-600 mt-2">Chá»©c nÄƒng Black Level Ä‘iá»u chá»‰nh Ä‘iá»ƒm Ä‘en, vá» cÆ¡ báº£n kiá»ƒm soÃ¡t Ä‘iá»ƒm tá»‘i nháº¥t trong hÃ¬nh áº£nh. Má»™t mÃ u Ä‘en bá»‹ "crush" (Ã©p xuá»‘ng) cÃ³ thá»ƒ thÃªm ká»‹ch tÃ­nh vÃ  Ä‘á»™ tÆ°Æ¡ng pháº£n, trong khi mÃ u Ä‘en Ä‘Æ°á»£c "lift" (nÃ¢ng lÃªn) â€“ thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  "mÃ u Ä‘en má»" hoáº·c "mÃ u Ä‘en sá»¯a" â€“ lÃ  má»™t Ä‘áº·c Ä‘iá»ƒm cá»§a nhiá»u loáº¡i phim cá»• Ä‘iá»ƒn vÃ  cÃ³ thá»ƒ táº¡o ra cáº£m giÃ¡c má»m máº¡i, thanh tao hoáº·c cá»• Ä‘iá»ƒn hÆ¡n.</p></details>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <details class="pp-infographic-item"><summary class="font-bold cursor-pointer">4. <span data-translate-key="ppItemColorDepth"></span></summary><p class="text-sm text-gray-600 mt-2">Chá»©c nÄƒng Color Depth Ä‘iá»u chá»‰nh Ä‘á»™ sÃ¡ng cho tá»«ng pha mÃ u (Äá», Lá»¥c, Lam, Lá»¥c lam, Äá» tÆ°Æ¡i, VÃ ng) riÃªng láº». KhÃ´ng giá»‘ng nhÆ° Saturation toÃ n cáº§u hoáº·c Color Phase, Color Depth cho phÃ©p Ä‘iá»u chá»‰nh Ä‘á»™ sÃ¡ng trÃªn tá»«ng kÃªnh, mang láº¡i kháº£ nÄƒng kiá»ƒm soÃ¡t chÃ­nh xÃ¡c hÆ¡n. ThÃ´ng sá»‘ nÃ y cá»±c ká»³ máº¡nh máº½ Ä‘á»ƒ chá»‰nh mÃ u tinh táº¿ nhÆ°ng cÃ³ tÃ¡c Ä‘á»™ng trá»±c tiáº¿p trong mÃ¡y áº£nh.</p></details>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </section>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <section class="bg-gradient-to-b from-slate-100 to-white rounded-2xl shadow-lg p-6 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl md:text-3xl font-bold text-center" data-translate-key="ppInfographicTitle"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="max-w-3xl mx-auto text-center text-gray-700 mt-2 mb-10">LÃ m theo cÃ¡c bÆ°á»›c sau Ä‘á»ƒ thiáº¿t láº­p Picture Profile tá»« Ä‘áº§u, cho phÃ©p báº¡n kiá»ƒm soÃ¡t hoÃ n toÃ n giao diá»‡n cuá»‘i cÃ¹ng cá»§a hÃ¬nh áº£nh.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemBlackLevel"></h5><p class="text-sm text-gray-600 mt-1">Thiáº¿t láº­p Ä‘iá»ƒm Ä‘en (vÃ¹ng tá»‘i nháº¥t). TÄƒng (+) Ä‘á»ƒ nÃ¢ng vÃ¹ng tá»‘i (táº¡o look 'faded' hoÃ i cá»•), giáº£m (-) Ä‘á»ƒ vÃ¹ng tá»‘i sÃ¢u hÆ¡n (tÄƒng tÆ°Æ¡ng pháº£n).</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center text-gray-400 font-bold">â†“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemGamma"></h5><p class="text-sm text-gray-600 mt-1">Thiáº¿t láº­p Ä‘Æ°á»ng cong tÆ°Æ¡ng pháº£n (contrast curve). ÄÃ¢y lÃ  ná»n táº£ng cho 'look' cá»§a báº¡n. Still & Movie cho Ä‘á»™ tÆ°Æ¡ng pháº£n cao, trong khi cÃ¡c gamma Cine/S-Log cho dáº£i nháº¡y sÃ¡ng rá»™ng hÆ¡n.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center text-gray-400 font-bold">â†“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemBlackGamma"></h5><p class="text-sm text-gray-600 mt-1">Tinh chá»‰nh Ä‘Æ°á»ng cong tÆ°Æ¡ng pháº£n á»Ÿ vÃ¹ng tá»‘i. 'Wide' áº£nh hÆ°á»Ÿng vÃ¹ng rá»™ng hÆ¡n, 'Narrow' áº£nh hÆ°á»Ÿng vÃ¹ng háº¹p hÆ¡n. Viá»‡c Ä‘iá»u chá»‰nh Black Gamma ráº¥t cáº§n thiáº¿t Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¡c giao diá»‡n Ä‘iá»‡n áº£nh cá»¥ thá»ƒ, nÆ¡i chi tiáº¿t vÃ  káº¿t cáº¥u bÃ³ng tá»‘i lÃ  ráº¥t quan trá»ng.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemKnee"></h5><p class="text-sm text-gray-600 mt-1">Kiá»ƒm soÃ¡t Ä‘á»™ nÃ©n á»Ÿ vÃ¹ng sÃ¡ng (highlight) Ä‘á»ƒ trÃ¡nh bá»‹ 'chÃ¡y'. Cháº¿ Ä‘á»™ tá»± Ä‘á»™ng (Auto) hoáº¡t Ä‘á»™ng tá»‘t, cháº¿ Ä‘á»™ thá»§ cÃ´ng (Manual) cho phÃ©p kiá»ƒm soÃ¡t chÃ­nh xÃ¡c hÆ¡n. Chá»©c nÄƒng Knee lÃ  vÃ´ giÃ¡ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cáº£nh quay "tá»©c thÃ¬" cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c trong cÃ¡c tÃ¬nh huá»‘ng cÃ³ Ä‘á»™ tÆ°Æ¡ng pháº£n cao.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center text-gray-400 font-bold">â†“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemColorMode"></h5><p class="text-sm text-gray-600 mt-1">XÃ¡c Ä‘á»‹nh cÃ¡ch mÃ u sáº¯c Ä‘Æ°á»£c tÃ¡i táº¡o. NÃªn chá»n cháº¿ Ä‘á»™ phÃ¹ há»£p vá»›i Gamma Ä‘Ã£ chá»n (vÃ­ dá»¥: Cine4 vá»›i Pro/Cinema, S-Log3 vá»›i S-Gamut3.Cine).</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center text-gray-400 font-bold">â†“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemSaturation"></h5><p class="text-sm text-gray-600 mt-1">Äiá»u chá»‰nh Ä‘á»™ Ä‘áº­m/nháº¡t tá»•ng thá»ƒ cá»§a táº¥t cáº£ cÃ¡c mÃ u. Äá»™ bÃ£o hÃ²a khÃ´ng chá»‰ lÃ  lÃ m cho mÃ u sáº¯c ná»•i báº­t; nÃ³ lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ truyá»n táº£i tÃ¢m tráº¡ng vÃ  thá»ƒ loáº¡i.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemColorPhase"></h5><p class="text-sm text-gray-600 mt-1">Xoay trá»¥c mÃ u sáº¯c tá»•ng thá»ƒ. Há»¯u Ã­ch Ä‘á»ƒ tinh chá»‰nh nháº¹ toÃ n bá»™ tÃ´ng mÃ u mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n tá»«ng mÃ u riÃªng láº». Máº·c dÃ¹ Ã­t trá»±c quan hÆ¡n cho cÃ¡c Ä‘iá»u chá»‰nh sÃ¡ng táº¡o chung, Color Phase lÃ  vÃ´ giÃ¡ trong cÃ¡c sáº£n pháº©m Ä‘a mÃ¡y áº£nh.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pp-infographic-item"><h5 data-translate-key="ppItemDetail"></h5><p class="text-sm text-gray-600 mt-1">Kiá»ƒm soÃ¡t Ä‘á»™ sáº¯c nÃ©t. Äá»ƒ cÃ³ 'look' phim má»m máº¡i, hÃ£y giáº£m máº¡nh (vÃ­ dá»¥: -7). Viá»‡c Ä‘á» xuáº¥t cÃ¡c cÃ i Ä‘áº·t Detail thÃ­ch há»£p lÃ  ráº¥t quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o Ä‘áº§u ra "tá»©c thÃ¬" trÃ´ng bÃ³ng báº©y vÃ  tá»± nhiÃªn, khÃ´ng bá»‹ xá»­ lÃ½ quÃ¡ má»©c.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="text-center text-gray-400 font-bold">â†“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pp-infographic-item"><h5 data-translate-key="ppItemColorDepth"></h5><p class="text-sm text-gray-600 mt-1">CÃ´ng cá»¥ máº¡nh máº½ nháº¥t. TÄƒng/giáº£m Ä‘á»™ sÃ¡ng cá»§a tá»«ng kÃªnh mÃ u riÃªng láº» (Äá», Lá»¥c, Lam, Lá»¥c lam, TÃ­m, VÃ ng). ÄÃ¢y lÃ  má»™t cÃ´ng cá»¥ quan trá»ng Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c sá»± phÃ¢n tÃ¡ch mÃ u sáº¯c vÃ  nháº¥n máº¡nh mÃ u sáº¯c cÃ³ sáº¯c thÃ¡i, chuyÃªn nghiá»‡p.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mt-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="exploreMoreBtn" class="btn btn-primary py-3 px-8 text-base md:text-lg" data-translate-key="navRecipeFormulas"></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </section>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl md:text-3xl font-bold text-center mb-4" data-translate-key="recallTitle"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="max-w-3xl mx-auto text-center text-gray-700 mb-8" data-translate-key="recallDesc"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-100 rounded-lg p-6 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-slate-700 mb-2" data-translate-key="recallInternalTitle"></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">LÆ°u trá»±c tiáº¿p vÃ o mÃ¡y. Truy cáº­p nhanh nháº¥t báº±ng cÃ¡ch xoay vÃ²ng xoay cháº¿ Ä‘á»™. LÃ½ tÆ°á»Ÿng cho cÃ¡c cÃ´ng thá»©c báº¡n sá»­ dá»¥ng hÃ ng ngÃ y.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-100 rounded-lg p-6 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-slate-700 mb-2" data-translate-key="recallCardTitle"></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm">LÆ°u dÆ°á»›i dáº¡ng file trÃªn tháº» nhá»›. Cá»±c ká»³ há»¯u Ã­ch Ä‘á»ƒ sao lÆ°u an toÃ n hoáº·c chuyá»ƒn cÃ´ng thá»©c sang má»™t thÃ¢n mÃ¡y Sony khÃ¡c.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl md:text-3xl font-bold text-center mb-4" data-translate-key="exposureNoteTitle"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="max-w-3xl mx-auto text-center text-gray-700">Háº§u háº¿t cÃ¡c cÃ´ng thá»©c Ä‘Æ°á»£c tá»‘i Æ°u khi chá»¥p á»Ÿ má»©c phÆ¡i sÃ¡ng 0EV vá»›i cháº¿ Ä‘á»™ Ä‘o sÃ¡ng 'ToÃ n mÃ n hÃ¬nh trung bÃ¬nh' (Entire Screen Avg.). Tuy nhiÃªn, cÃ¡c cÃ´ng thá»©c dá»±a trÃªn S-Log cÃ³ thá»ƒ cáº§n tÄƒng phÆ¡i sÃ¡ng (overexpose) Ä‘á»ƒ cÃ³ káº¿t quáº£ tá»‘t nháº¥t. Viá»‡c phÆ¡i sÃ¡ng Ä‘Ãºng cÃ¡ch Ä‘áº£m báº£o ráº±ng mÃ¡y áº£nh thu Ä‘Æ°á»£c lÆ°á»£ng Ã¡nh sÃ¡ng vÃ  chi tiáº¿t tá»‘i Æ°u, cho phÃ©p Picture Profile phÃ¡t huy tÃ¡c dá»¥ng má»™t cÃ¡ch hiá»‡u quáº£.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </main>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <footer class="text-center text-sm text-gray-500 pt-8 mt-12 border-t">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p data-translate-key="footerText"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </footer>
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â </div>`
};

function openLightbox(images, initialIndex = 0) {
if (!images || images.length === 0) return;
state.lightbox.isOpen = true;
state.lightbox.images = images;
state.lightbox.currentIndex = initialIndex;
const lightboxEl = document.getElementById('lightbox');
lightboxEl.classList.remove('hidden');
updateLightboxContent();
}

function closeLightbox() {
state.lightbox.isOpen = false;
document.getElementById('lightbox').classList.add('hidden');
}

function updateLightboxContent() {
if (!state.lightbox.isOpen) return;
const mainImageEl = document.getElementById('lightbox-main-image');
const thumbnailsContainer = document.getElementById('lightbox-thumbnails');
const newSrc = state.lightbox.images[state.lightbox.currentIndex];
mainImageEl.style.opacity = '0';
setTimeout(() => {
mainImageEl.src = newSrc;
mainImageEl.onload = () => { mainImageEl.style.opacity = '1'; };
}, 150);

thumbnailsContainer.innerHTML = state.lightbox.images.map((imgSrc, index) => `
Â  Â  Â  Â  Â  Â  Â  Â <img src="${imgSrc}" loading="lazy" class="lightbox-thumb w-16 h-16 md:w-20 md:h-20 object-cover rounded-md ${index === state.lightbox.currentIndex ? 'active' : ''}" data-index="${index}">
Â  Â  Â  Â  Â  Â `).join('');
}

function navigateLightbox(direction) {
if (!state.lightbox.isOpen) return;
const imageCount = state.lightbox.images.length;
let newIndex = state.lightbox.currentIndex + direction;
if (newIndex < 0) newIndex = imageCount - 1;
else if (newIndex >= imageCount) newIndex = 0;
state.lightbox.currentIndex = newIndex;
updateLightboxContent();
}

function destroyAllCharts() {
Object.values(activeCharts).forEach(chart => { if(chart && typeof chart.destroy === 'function') chart.destroy(); });
activeCharts = {};
}

function initInteractiveGrid() {
const grid = document.getElementById('abgm-grid');
const pointer = document.getElementById('abgm-pointer');
const valuesDisplay = document.getElementById('abgm-values');
if (!grid || !pointer || !valuesDisplay) return;

let isDragging = false;

function updatePosition(clientX, clientY) {
const rect = grid.getBoundingClientRect();
let x = clientX - rect.left;
let y = clientY - rect.top;

x = Math.max(0, Math.min(x, rect.width));
y = Math.max(0, Math.min(y, rect.height));

pointer.style.left = `${x}px`;
pointer.style.top = `${y}px`;

const abValue = Math.round((x / rect.width) * 18 - 9);
const gmValue = Math.round(((rect.height - y) / rect.height) * 18 - 9);Â 

const abLabel = abValue > 0 ? `A${abValue}` : (abValue < 0 ? `B${Math.abs(abValue)}` : '0');
const gmLabel = gmValue > 0 ? `G${gmValue}` : (gmValue < 0 ? `M${Math.abs(gmValue)}` : '0');

valuesDisplay.textContent = `${abLabel}, ${gmLabel}`;
}

grid.addEventListener('mousedown', (e) => {
isDragging = true;
updatePosition(e.clientX, e.clientY);
});

grid.addEventListener('touchstart', (e) => {
isDragging = true;
updatePosition(e.touches[0].clientX, e.touches[0].clientY);
e.preventDefault();
});

document.addEventListener('mousemove', (e) => {
if (isDragging) updatePosition(e.clientX, e.clientY);
});

document.addEventListener('touchmove', (e) => {
if (isDragging) updatePosition(e.touches[0].clientX, e.touches[0].clientY);
});

document.addEventListener('mouseup', () => { isDragging = false; });
document.addEventListener('touchend', () => { isDragging = false; });
}


function renderView(viewName) {
return new Promise(resolve => {
const currentContent = mainContentEl.children[0];
if (currentContent) {
currentContent.classList.add('view-transition-out');
destroyAllCharts();
currentContent.addEventListener('animationend', () => {
mainContentEl.innerHTML = viewTemplates[viewName]();
attachViewEventListeners(viewName);
applyTranslations();
resolve();
}, { once: true });
} else {
mainContentEl.innerHTML = viewTemplates[viewName]();
attachViewEventListeners(viewName);
applyTranslations();
resolve();
}
});
}

function handleFilterClick(e) {
const btn = e.target.closest('.filter-btn'); if (!btn) return;
const group = btn.closest('[data-filter-group]').dataset.filterGroup;
const value = btn.dataset.filterValue;Â 
state.activeFilters[group] = value;

// Syncs active state across both mobile and desktop filter sets
document.querySelectorAll(`[data-filter-group="${group}"] .filter-btn`).forEach(b => {
b.classList.toggle('active', b.dataset.filterValue === value);
});

renderLibraryList();
}

function handleRecipeSelection(id, type) {
if (type === 'checkbox') {
const index = state.comparisonList.indexOf(id);
if (index > -1) { state.comparisonList.splice(index, 1); }Â 
else if (state.comparisonList.length < 2) { state.comparisonList.push(id); }
} else {
if (state.selectedRecipeId === id) {
state.selectedRecipeId = null;
state.isMobileDetailActive = false;
} else {
state.selectedRecipeId = id;
state.isMobileDetailActive = true;
}
state.comparisonList = [];
}
renderLibraryList();
renderLibraryDetails();

if (activeCharts.color && typeof activeCharts.color.update === 'function') { activeCharts.color.update(); }
if (activeCharts.bw && typeof activeCharts.bw.update === 'function') { activeCharts.bw.update(); }
}

async function handleAiComparison(id1, id2, recipe2Obj = null) {
const modal = document.getElementById('comparisonModal');
const titleEl = document.getElementById('comparisonModalTitle');
const contentEl = document.getElementById('comparisonModalContent');
modal.classList.remove('hidden');
titleEl.textContent = t('comparisonModalTitle');
contentEl.innerHTML = `<div class="flex items-center justify-center p-8"><div class="spinner !w-12 !h-12 !border-4"></div><p class="ml-4 text-lg font-semibold">${t('comparisonLoading')}</p></div>`;
const recipe1 = recipesData.find(r => r.id === id1);
const recipe2 = recipe2Obj ? { ...recipe2Obj, id: 'ai-adjusted', name: recipe2Obj.name } : recipesData.find(r => r.id === id2);
const prompt = `Compare the following two recipes: *${recipe1.name[state.currentLang]}* (ID: ${recipe1.id}) and *${recipe2.name[state.currentLang]}* (ID: ${recipe2.id}). Analyze their overall feel, key parameter differences (like White Balance, Black Level, Gamma, Saturation, Color Depth), and suggest ideal use cases for each. Present the result in Markdown.`;
const comparisonText = await callAIApi(prompt, false); // Expecting Markdown, not structured JSON
contentEl.innerHTML = marked.parse(comparisonText || "Error loading comparison.");
applyTranslations();
}

async function handleAiAdjustment(button) {
const recipeId = button.dataset.recipeId;
const textarea = document.getElementById('aiTuningTextarea');
const resultContainer = document.getElementById('aiResultContainer');
if (!textarea.value || !resultContainer || state.isAILoading) return;

button.disabled = true;Â 
button.dataset.originalText = button.innerHTML;
button.innerHTML = `<div class="spinner"></div> ${t('aiTuningBtn')}`;

const originalRecipe = recipesData.find(r => r.id === recipeId);
// Construct a more detailed prompt for AI adjustment
const prompt = `Given the original recipe settings: ${JSON.stringify(originalRecipe.settings)}, and color depth: ${JSON.stringify(originalRecipe.colorDepth || {})}, and detail settings: ${JSON.stringify(originalRecipe.detailSettings || {})}.
The user wants to adjust this recipe with the following request: "${textarea.value}".
Please provide a new JSON object representing the adjusted recipe. The new recipe should maintain the original structure, including 'id', 'name', 'description' (with 'vi' and 'en' keys, append " (AI Adjusted)" to the name), 'type', 'contrast', 'saturation', 'tags', 'whiteBalance', 'settings', 'colorDepth', 'detailSettings', 'personalityColor', and 'coords'.
Adjust the 'settings', 'colorDepth', 'detailSettings', and 'whiteBalance' based on the request. For 'name' and 'description', translate the original content and append "(AI Adjusted)" to the name.
Example of expected JSON structure:
{
Â  "recipe": {
Â  Â  "id": "scl-001-ai",
Â  Â  "name": {"vi": "Mojave Sun (AI Tinh chá»‰nh)", "en": "Mojave Sun (AI Adjusted)"},
Â  Â  "description": {"vi": "MÃ´ táº£ má»›i dá»±a trÃªn tinh chá»‰nh AI.", "en": "New description based on AI adjustment."},
Â  Â  "type": "color",
Â  Â  "contrast": "normal",
Â  Â  "saturation": "normal",
Â  Â  "tags": ["nostalgic", "sun-drenched", "warm", "travel", "lifestyle", "summer", "golden-hour"],
Â  Â  "whiteBalance": "5500K, A6-M1",
Â  Â  "settings": { "Black level": "0", "Gamma": "Movie", "Black Gamma": "Wide +7", "Knee": "Manual 75% +4", "Color Mode": "S-Gamut3", "Saturation": "+32", "Color Phase": "+6" },
Â  Â  "colorDepth": { "R": "-2", "G": "0", "B": "+5", "C": "+5", "M": "0", "Y": "+4" },
Â  Â  "detailSettings": { "Level": "0" },
Â  Â  "personalityColor": "#FFD700",
Â  Â  "coords": { "x": 6, "y": 7 }
Â  }
}
Please ensure all original fields are present and only the requested adjustments are made to the relevant settings.
`;
const aiResponse = await callAIApi(prompt, true); // Expecting structured JSON

if (aiResponse && aiResponse.recipe) {
state.lastGeneratedAiRecipe = aiResponse.recipe;
resultContainer.innerHTML = `<div class="mt-6 border-t border-gray-200/50 pt-6"><h4 class="font-bold text-lg mb-2">${state.lastGeneratedAiRecipe.name[state.currentLang]}</h4><div class="p-4 rounded-xl bg-blue-50">${createFullRecipeHTML(state.lastGeneratedAiRecipe, false)}</div><button id="compareWithOriginalBtn" data-original-id="${recipeId}" class="btn btn-secondary w-full mt-4 py-3 bg-gray-200 text-black" data-translate-key="compareWithOriginalBtn"></button></div>`;
} else { resultContainer.innerHTML = `<p class="text-red-500">Failed to generate adjustment. Please try again.</p>`; }
button.disabled = false; button.innerHTML = button.dataset.originalText; applyTranslations();
}

async function handleQuizSubmit() {
const selectedTags = Object.values(state.quizAnswers);
await renderView('home');
const homeView = document.getElementById('homeView');
if (!homeView) { console.error("Quiz Submit Error: homeView not found after render."); return; }
homeView.innerHTML = `<div class="flex flex-col items-center justify-center h-full"><div class="spinner !w-16 !h-16 !border-4"></div><h2 class="landing-title mt-8" data-translate-key="loadingAnalyze"></h2></div>`;
applyTranslations();

// Construct a prompt for the AI to suggest recipes based on quiz answers
const prompt = `Based on the user's quiz answers (tags): ${JSON.stringify(selectedTags)}.
Suggest 2 existing recipes from the provided 'recipesData' that best match these tags.
Provide the output as a JSON array of objects, each with 'recipeId' (the 'id' of the recipe) and 'moodDescription' (the recipe's description in the current language).
Example:
[
Â  {"recipeId": "scl-001", "moodDescription": "A nostalgic, sun-drenched style..."},
Â  {"recipeId": "scl-002", "moodDescription": "A serene and subtle palette..."}
]`;

const aiResponse = await callAIApi(prompt, true); // Expecting structured JSON

if (aiResponse && aiResponse.length >= 2) {
const r1 = recipesData.find(r => r.id === aiResponse[0].recipeId);
const r2 = recipesData.find(r => r.id === aiResponse[1].recipeId);
if (r1 && r2) {
homeView.innerHTML = `<div class="w-full h-full flex items-center justify-center absolute inset-0 view-transition"><div class="quiz-result-container p-6 md:p-8 rounded-3xl w-full max-w-5xl mx-auto glass-panel"><h3 class="text-2xl md:text-3xl font-bold mb-6 md:mb-8 text-center" data-translate-key="quizResultTitle"></h3><div class="grid md:grid-cols-2 gap-6"><div class="quiz-choice-option p-6" data-recipe-id="${r1.id}"><h4 class="text-xl md:text-2xl font-bold mb-2">${r1.name[state.currentLang]}</h4><p class="text-base italic text-gray-600">"${r1.description[state.currentLang]}"</p></div><div class="quiz-choice-option p-6" data-recipe-id="${r2.id}"><h4 class="text-xl md:text-2xl font-bold mb-2">${r2.name[state.currentLang]}</h4><p class="text-base italic text-gray-600">"${r2.description[state.currentLang]}"</p></div></div></div></div>`;
applyTranslations();
// Add event listeners to the newly created result options
homeView.querySelectorAll('.quiz-choice-option').forEach(choice => {
choice.addEventListener('click', async () => {
state.selectedRecipeId = choice.dataset.recipeId;
state.isMobileDetailActive = true;
await renderView('recipeFormulas');
});
});
} else {
Â  Â  homeView.innerHTML = `<p class="text-red-500">Error: Could not find recipes based on AI suggestions.</p>`;
}
} else { homeView.innerHTML = `<p class="text-red-500">Lá»—i khi láº¥y Ä‘á» xuáº¥t tá»« AI.</p>`; }
}

function attachViewEventListeners(viewName) {
if (viewName === 'recipeFormulas') {
renderLibraryList();Â Â 
renderLibraryDetails();
renderInteractiveCharts(state.currentLang);
} else if (viewName === 'explain') {
initInteractiveGrid();
} else if (viewName === 'quiz') {
const quizView = document.getElementById('quizView');
quizView.addEventListener('click', (e) => {
const card = e.target.closest('.quiz-option-card');
if (!card) return;

const group = card.closest('[data-quiz-group]').dataset.quizGroup;
const value = card.dataset.value;

// Update state
state.quizAnswers[group] = value;

// Update UI
document.querySelectorAll(`[data-quiz-group="${group}"] .quiz-option-card`).forEach(c => c.classList.remove('selected'));
card.classList.add('selected');

// Animation
card.classList.remove('bouncing'); // reset animation
void card.offsetWidth; // trigger reflow
card.classList.add('bouncing');

// Check if all questions are answered
const allAnswered = quizQuestions.every(q => state.quizAnswers[q.id]);
document.getElementById('submitQuizBtn').disabled = !allAnswered;
});
document.getElementById('submitQuizBtn').addEventListener('click', handleQuizSubmit);
}
}

function renderLibraryList() {
const container = document.getElementById('recipeListContainer'); if (!container) return;
const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();
let recipesToRender = recipesData.filter(recipe => {
Â  Â  const nameMatch = recipe.name[state.currentLang].toLowerCase().includes(searchTerm);
Â  Â  const descriptionMatch = recipe.description[state.currentLang].toLowerCase().includes(searchTerm);
Â  Â  const typeMatch = state.activeFilters.type === 'all' || recipe.type === state.activeFilters.type;
Â  Â  const contrastMatch = state.activeFilters.contrast === 'all' || recipe.contrast === state.activeFilters.contrast;
Â  Â  const saturationMatch = state.activeFilters.saturation === 'all' || recipe.saturation === state.activeFilters.saturation;
Â  Â  return (nameMatch || descriptionMatch) && typeMatch && contrastMatch && saturationMatch;
});

container.innerHTML = recipesToRender.map(recipe => {
const isChecked = state.comparisonList.includes(recipe.id);
const isSelected = recipe.id === state.selectedRecipeId;

return `<div class="recipe-item p-3 rounded-xl transition-all duration-200 border-l-4 border-transparent flex items-start gap-4 ${isSelected ? 'selected' : ''}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="checkbox" class="recipe-compare-cb form-checkbox h-5 w-5 text-blue-600 rounded-md border-gray-300 focus:ring-blue-500 self-start mt-1 flex-shrink-0" data-recipe-id="${recipe.id}" ${isChecked ? 'checked' : ''} ${state.comparisonList.length >= 2 && !isChecked ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow cursor-pointer recipe-item-content" data-recipe-id="${recipe.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="recipe-dot w-5 h-5 rounded-full flex-shrink-0 mt-1" style="background-color: ${recipe.personalityColor}" title="${recipe.name[state.currentLang]}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="font-semibold text-primary">${recipe.name[state.currentLang]}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-neutral-600 mt-1 leading-snug">${recipe.description[state.currentLang]}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>`;
}).join('');

const btnContainer = document.getElementById('compareBtnContainer');
btnContainer.innerHTML = `<button id="compareBtn" class="btn btn-primary w-full mt-4 py-3" data-translate-key="compareBtn" ${state.comparisonList.length !== 2 ? 'disabled' : ''}></button>`;
applyTranslations();
}

function renderLibraryDetails() {
const isMobile = window.innerWidth < 768;
const recipeListPanel = document.getElementById('recipeListPanel');
const recipeMainPanel = document.getElementById('recipeMainPanel');
const recipeDetailPanelMobile = document.getElementById('recipeDetailPanelMobile');

if (isMobile) {
if(state.isMobileDetailActive) {
recipeListPanel.classList.add('hidden');
recipeDetailPanelMobile.classList.remove('hidden');
} else {
recipeListPanel.classList.remove('hidden');
recipeDetailPanelMobile.classList.add('hidden');
}
} else {
recipeListPanel?.classList.remove('hidden');
recipeDetailPanelMobile?.classList.add('hidden');
}

const recipe = recipesData.find(r => r.id === state.selectedRecipeId);

let recipeContentContainer, chartsContainer;
if (isMobile && state.isMobileDetailActive) {
recipeContentContainer = document.getElementById('recipeContentMobile');
chartsContainer = null;
} else {
recipeContentContainer = document.getElementById('recipeContent');
chartsContainer = document.getElementById('chartsContainer');
}

if (!recipeContentContainer) return;

if (!recipe) {Â Â 
if (chartsContainer) chartsContainer.classList.remove('hidden');
recipeContentContainer.classList.add('hidden');
if(!isMobile) recipeMainPanel?.classList.remove('hidden');
return;Â  Â 
}
if (chartsContainer) chartsContainer.classList.add('hidden');
recipeContentContainer.classList.remove('hidden');
if(!isMobile) recipeMainPanel?.classList.remove('hidden');

let thumbnailsHTML = '';
const images = recipe.demoImages || [];
let imageElements = [];
images.forEach((imgSrc, index) => {
imageElements.push(`<div class="bg-gray-200 group rounded-xl overflow-hidden cursor-pointer lightbox-trigger-thumb" data-recipe-id="${recipe.id}" data-index="${index}"><img src="${imgSrc}" loading="lazy" alt="áº¢nh demo ${recipe.name[state.currentLang]} ${index + 1}" class="aspect-[4/3] w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"></div>`);
});
const placeholdersNeeded = 3 - imageElements.length;
const placeholderColor = recipe.personalityColor ? recipe.personalityColor.substring(1) : 'cccccc';
for (let i = 0; i < placeholdersNeeded; i++) {
const placeholderIndex = images.length + i;
imageElements.push(`<div class="bg-gray-200 group rounded-xl overflow-hidden"><img src="https://placehold.co/400x300/${placeholderColor}/ffffff?text=${encodeURIComponent(recipe.name[state.currentLang])}+Sample+${placeholderIndex + 1}" loading="lazy" alt="áº¢nh minh há»a ${recipe.name[state.currentLang]} ${placeholderIndex + 1}" class="aspect-[4/3] w-full h-full object-cover"></div>`);
}
thumbnailsHTML = `<div class="my-6"><div class="grid grid-cols-3 gap-2 md:gap-4">${imageElements.join('')}</div></div>`;

const exportSectionHTML = `
Â  Â  Â  Â  Â  Â  Â  Â <div class="mt-12 pt-8 border-t-2 border-gray-200/60">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-xl md:text-2xl font-bold mb-4" data-translate-key="exportRecipeBtn"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="downloadLutBtn" data-recipe-id="${recipe.id}" class="btn bg-blue-100 text-blue-800 hover:bg-blue-200 w-full py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span data-translate-key="downloadLutBtn"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="memoryRecallGuideBtn" class="btn bg-gray-200 text-gray-800 hover:bg-gray-300 w-full py-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span data-translate-key="memoryRecallBtn"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â `;

recipeContentContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-3xl md:text-4xl font-bold">${recipe.name[state.currentLang]}</h3>
Â  Â  Â  Â  Â  Â  Â  Â <p class="text-lg text-neutral-600 mt-2 italic">"${recipe.description[state.currentLang]}"</p>
Â  Â  Â  Â  Â  Â  Â  Â ${thumbnailsHTML}
Â  Â  Â  Â  Â  Â  Â  Â ${exportSectionHTML}
Â  Â  Â  Â  Â  Â  Â  Â <div id="originalRecipeContainer" class="mt-8">${createFullRecipeHTML(recipe, true)}</div>
Â  Â  Â  Â  Â  Â  Â  Â <div id="setupGuideSection" class="mt-12 pt-8 border-t-2 border-gray-200/60">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <details open class="group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <summary class="text-xl md:text-2xl font-bold cursor-pointer list-none flex justify-between items-center group-hover:text-blue-600 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span data-translate-key="tutorialTitle"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg class="w-6 h-6 transition-transform transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </summary>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="prose max-w-none mt-6 space-y-4 text-base text-gray-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="font-bold" data-translate-key="tutorialStep1Title"></h4><p data-translate-key="tutorialStep1P1"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="font-bold" data-translate-key="tutorialStep2Title"></h4><p data-translate-key="tutorialStep2P1"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="font-bold" data-translate-key="tutorialStep3Title"></h4><p data-translate-key="tutorialStep3P1"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div><h4 class="font-bold" data-translate-key="tutorialStep4Title"></h4><p data-translate-key="tutorialStep4P1"></p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </details>
Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â <div class="mt-12 pt-8 border-t-2 border-gray-200/60">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 class="text-xl md:text-2xl font-bold mb-4" data-translate-key="aiTuningTitle"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="glass-panel p-4 md:p-6 -mx-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <textarea id="aiTuningTextarea" class="w-full p-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 transition-shadow" rows="3" data-translate-key="aiTuningPlaceholder"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="aiTuningBtn" data-recipe-id="${recipe.id}" class="btn btn-primary w-full mt-4 py-3" data-translate-key="aiTuningBtn"></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="aiResultContainer"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â </div>`;
applyTranslations();
}

function renderInteractiveCharts(lang) {
destroyAllCharts();
const chartDefaultOptions = (yAxisTitleKey) => ({
responsive: true,
maintainAspectRatio: false,
onClick: (e) => {
const chart = e.chart;
const elements = chart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
if (elements.length) {
const firstPoint = elements[0];
const recipeId = chart.data.datasets[firstPoint.datasetIndex].data[firstPoint.index].id;
if (recipeId) { handleRecipeSelection(recipeId, 'chart'); }
}
},
plugins: {
legend: { display: false },
tooltip: {
backgroundColor: 'rgba(0,0,0,0.8)',
titleFont: { size: 14 },
bodyFont: { size: 13 },
padding: 10,
callbacks: { label: function(context) { return context.raw.name; } }
}
},
scales: {
x: { min: -10, max: 10, grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { display: false }, border: { dash: [4, 4] }, title: { display: true, text: t('axisTonality') } }
,
y: { min: -10, max: 10, grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { display: false }, border: { dash: [4, 4] }, title: { display: true, text: t(yAxisTitleKey) } }
}
});

const colorCtx = document.getElementById('colorChart')?.getContext('2d');
if (colorCtx) {
const colorData = recipesData.filter(r => r.type === 'color' && r.coords && typeof r.coords.x === 'number' && typeof r.coords.y === 'number' && r.personalityColor).map(r => ({ ...r.coords, id: r.id, name: r.name[lang] }));
activeCharts.color = new Chart(colorCtx, {
type: 'scatter',
data: {
datasets: [{
data: colorData,
pointBackgroundColor: colorData.map(d => {
const recipe = recipesData.find(r => r.id === d.id);
return recipe ? recipe.personalityColor : '#CCCCCC';
}),
pointBorderColor: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? '#007AFF' : 'rgba(255, 255, 255, 0.8)'),
pointBorderWidth: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? 4 : 2),
pointRadius: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? 11 : 7),
pointHoverRadius: 11
}]
},
options: chartDefaultOptions('axisSaturation')
});
}

const bwCtx = document.getElementById('bwChart')?.getContext('2d');
if (bwCtx) {
const bwData = recipesData.filter(r => r.type === 'bw' && r.coords && typeof r.coords.x === 'number' && typeof r.coords.y === 'number').map(r => ({ ...r.coords, id: r.id, name: r.name[lang] }));
activeCharts.bw = new Chart(bwCtx, {
type: 'scatter',
data: {
datasets: [{
data: bwData,
pointBackgroundColor: '#475569',
pointBorderColor: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? '#007AFF' : 'rgba(255, 255, 255, 0.8)'),
pointBorderWidth: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? 4 : 2),
pointRadius: (ctx) => (ctx.raw?.id === state.selectedRecipeId ? 11 : 7),
pointHoverRadius: 11,
pointHoverBorderWidth: 3
}]
},
options: chartDefaultOptions('axisChroma')
});
}
}

function toggleMobileNav(show) {
const menu = document.getElementById('mobileNavMenu');
menu.classList.toggle('translate-x-full', !show);
}

function handleDropdownNav() {
const container = document.getElementById('pp-dropdown-container');
const btn = document.getElementById('pp-dropdown-btn');
const menu = document.getElementById('pp-dropdown-menu');
const chevron = document.getElementById('pp-dropdown-chevron');

if (!container || !btn || !menu) return;

btn.addEventListener('click', (e) => {
e.stopPropagation();
const isHidden = menu.classList.contains('hidden');
if (isHidden) {
menu.classList.remove('hidden');
setTimeout(() => {
menu.classList.remove('opacity-0', 'scale-95');
chevron.style.transform = 'rotate(180deg)';
}, 10);
} else {
menu.classList.add('opacity-0', 'scale-95');
chevron.style.transform = 'rotate(0deg)';
menu.addEventListener('transitionend', () => {
menu.classList.add('hidden');
}, { once: true });
}
});

document.addEventListener('click', (e) => {
if (!container.contains(e.target)) {
menu.classList.add('opacity-0', 'scale-95');
chevron.style.transform = 'rotate(0deg)';
if (!menu.classList.contains('hidden')) {
menu.addEventListener('transitionend', () => {
menu.classList.add('hidden');
}, { once: true });
}
}
});
}

// Cookie helper functions
function setCookie(name, value, days) {
let expires = "";
if (days) {
const date = new Date();
date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
expires = "; expires=" + date.toUTCString();
}
document.cookie = name + "=" + (value || "") + expires + "; path=/";
}

function getCookie(name) {
const nameEQ = name + "=";
const ca = document.cookie.split(';');
for(let i = 0; i < ca.length; i++) {
let c = ca[i];
while (c.charAt(0) == ' ') c = c.substring(1, c.length);
if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
}
return null;
}

function init() {
document.body.addEventListener('click', async (e) => {
const target = e.target;

if (state.lightbox.isOpen) {
if (target.id === 'lightbox-bg' || target.closest('#lightbox-close')) { closeLightbox(); }Â 
else if (target.closest('#lightbox-next')) { navigateLightbox(1); }Â 
else if (target.closest('#lightbox-prev')) { navigateLightbox(-1); }
const thumb = target.closest('.lightbox-thumb');
if (thumb) {
state.lightbox.currentIndex = parseInt(thumb.dataset.index);
updateLightboxContent();
}
return;Â 
}

const lightboxTrigger = target.closest('.lightbox-trigger-thumb');
const homeBtn = target.closest('#homeBtn');
const navBtn = target.closest('.nav-btn');Â 
const mobileNavBtn = target.closest('.nav-btn-mobile');
const langBtn = target.closest('.lang-btn');
const startQuizBtn = target.closest('#startQuizBtn');
const exploreMoreBtn = target.closest('#exploreMoreBtn');
const hamburgerBtn = target.closest('#hamburgerBtn');
const closeMobileNavBtn = target.closest('#closeMobileNavBtn');

if (hamburgerBtn) { toggleMobileNav(true); return; }
if (closeMobileNavBtn || (target.id === 'mobileNavMenu' && !target.closest('#mobileNavMenu > div'))) { toggleMobileNav(false); return; }
if (mobileNavBtn) {
toggleMobileNav(false);
state.selectedRecipeId = null; state.isMobileDetailActive = false;
await renderView(mobileNavBtn.dataset.view); return;
}
if (homeBtn) { state.selectedRecipeId = null; state.isMobileDetailActive = false; await renderView('home'); return; }
if (navBtn) {Â 
const dropdownMenu = document.getElementById('pp-dropdown-menu');
if (dropdownMenu && !dropdownMenu.classList.contains('hidden')) {
dropdownMenu.classList.add('opacity-0', 'scale-95', 'hidden');
document.getElementById('pp-dropdown-chevron').style.transform = 'rotate(0deg)';
}
state.selectedRecipeId = null;Â 
state.isMobileDetailActive = false;Â 
await renderView(navBtn.dataset.view);Â 
return;Â 
}
if (exploreMoreBtn) { state.selectedRecipeId = null; state.isMobileDetailActive = false; await renderView('recipeFormulas'); return; }
if (langBtn) { state.currentLang = langBtn.id.replace('lang', '').toLowerCase(); await renderView(state.currentView); return; }

if (startQuizBtn) {Â 
state.quizStep = 0;Â 
state.quizAnswers = {};Â 
await renderView('quiz');Â 
return;Â 
}

// BUG FIX: This listener is now inside handleQuizSubmit, but we keep a global one for other cases.
const quizChoice = target.closest('.quiz-choice-option');
if (quizChoice) {
state.selectedRecipeId = quizChoice.dataset.recipeId;
state.isMobileDetailActive = true;
await renderView('recipeFormulas');
return;
}

const recipeItemContent = target.closest('.recipe-item-content');
const recipeDot = target.closest('.recipe-dot');
const recipeCompareCb = target.closest('.recipe-compare-cb');
const compareBtn = target.closest('#compareBtn');
const compareWithOriginalBtn = target.closest('#compareWithOriginalBtn');
const aiTuningBtn = target.closest('#aiTuningBtn');
const backToListBtn = target.closest('#backToListBtn');
const closeModalBtn = target.closest('#closeComparisonModalBtn');
const downloadLutBtn = target.closest('#downloadLutBtn');
const memoryRecallGuideBtn = target.closest('#memoryRecallGuideBtn');

if (recipeItemContent || recipeDot) { handleRecipeSelection(target.closest('[data-recipe-id]').dataset.recipeId, 'div'); return; }
if (recipeCompareCb) { handleRecipeSelection(recipeCompareCb.dataset.recipeId, 'checkbox'); return; }
if (compareBtn && !compareBtn.disabled) { handleAiComparison(state.comparisonList[0], state.comparisonList[1]); return; }
if (compareWithOriginalBtn) { handleAiComparison(compareWithOriginalBtn.dataset.originalId, null, state.lastGeneratedAiRecipe); return; }
if (aiTuningBtn) { handleAiAdjustment(aiTuningBtn); return; }
if (backToListBtn) { state.isMobileDetailActive = false; renderLibraryDetails(); return; }
if (closeModalBtn) { document.getElementById('comparisonModal').classList.add('hidden'); return; }
if (lightboxTrigger) {
const recipeId = lightboxTrigger.dataset.recipeId;
const recipe = recipesData.find(r => r.id === recipeId);
if (recipe && recipe.demoImages && recipe.demoImages.length > 0) {
openLightbox(recipe.demoImages, parseInt(lightboxTrigger.dataset.index));
}
return;
}
if (downloadLutBtn) {
const recipe = recipesData.find(r => r.id === downloadLutBtn.dataset.recipeId);
if (recipe) {
const lutContent = `# Generated by Alpha AI Color Lab for ${recipe.name[state.currentLang]}\nTITLE "${recipe.name[state.currentLang]}"\nLUT_3D_SIZE 33\n# Dummy LUT data\n0.0 0.0 0.0\n1.0 1.0 1.0`;
const blob = new Blob([lutContent], { type: 'text/plain' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `${recipe.id}.cube`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}
return;
}
if (memoryRecallGuideBtn) {
document.getElementById('setupGuideSection')?.scrollIntoView({ behavior: 'smooth' });
return;
}


if (document.getElementById('filtersContainer')?.contains(target) || document.getElementById('filtersContainerDesktop')?.contains(target)) {Â 
handleFilterClick(e); return;Â 
}
});

document.body.addEventListener('input', (e) => {
if (e.target.id === 'searchInput') {
renderLibraryList();
}
});

window.addEventListener('resize', () => { if(state.currentView === 'recipeFormulas') renderLibraryDetails(); });

// Welcome Modal Logic
const welcomeModal = document.getElementById('welcomeModal');
const closeWelcomeBtn = document.getElementById('closeWelcomeModalBtn');
if (!getCookie('welcomeLetterSeen')) {
welcomeModal.classList.remove('hidden');
welcomeModal.classList.add('flex');
}
closeWelcomeBtn.addEventListener('click', () => {
welcomeModal.classList.add('hidden');
welcomeModal.classList.remove('flex');
setCookie('welcomeLetterSeen', 'true', 365); // Set cookie for 1 year
});

renderView('home');
handleDropdownNav();
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
